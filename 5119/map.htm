<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<!-- saved from url=(0014)about:internet -->
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml">
<head>
<meta http-equiv="content-type" content="text/html; charset=utf-8"/>
<title>2015-5119</title>
<style type="text/css">  
	@import url("map5119.files/web/js/imgctrl/lytebox.css"); 
</style> 
<!-- embedded CSS file from "C:\PF\Utils\HOLUX ezTour21\web\css\gmapviewV3.css" -->
<!-- START HERE -->
<style type="text/css">  
/* iTravel Tech google map view V3 CSS */

html, body { 
  height: 100%;
  overflow: hidden;
}

body {
  background-color: white;
  font-family: Arial, sans-serif;
  margin: 0px; 
  padding: 0px;
}
    
#photoList {
  position: absolute;
  top: 0;
  bottom: 0;
  right: 0;
  width: 180px; /*Width of frame div*/
  height: 100%;
  overflow: auto; /* hidden: Disable scrollbars. Set to "scroll" to enable*/
  text-align: center;
  background: black;
  color: white;
}

.toggleopacity img{
  filter:progid:DXImageTransform.Microsoft.Alpha(opacity=50);
  -moz-opacity: 0.9;
}

.toggleopacity:hover img{
  filter:progid:DXImageTransform.Microsoft.Alpha(opacity=100);
  -moz-opacity: 1;
}

.toggleopacity img{
  border: 1px solid #ccc;
}

.toggleborder:hover img{
  border: 1px solid white;
}

.toggleborder:hover{
  color: red; /* Dummy definition to overcome IE bug */
}

#objectListBar {
	/* float: right; */
	position:absolute;
	top: 30px;
	right: 5px;
	z-index:101;
	/* border: 1px solid #000000; */
	/* width: 175px; */
	/* padding: 5px 6px; */
	margin: 0;
	font-family: Arial, sans-serif;
	font-size: small;
	/* background-color: #ffffff; */
}

#gMap { 
  height: 100%;
}

* html body{ /*IE6 hack*/
  padding: 0 0 0 0; /*Set value to (0 WidthOfFrameDiv 0 0)*/
}

* html { /*IE6 hack*/
  height: 100%; 
  width: 100%; 
}

#tBar { 
  position: absolute; 
  top: 50px; 
  right: 10px; 
  padding: 1px;
  width: 20px; 
  background: #ffffcc; 
  border: 1px solid #ffffcc; 
  font: 11px, Tahoma, Verdana, Helvetica, sans-serif; 
}

.cButton { 
  border: 1px solid white; 
}

.pmInfo { 
  font: 11px, Tahoma, Verdana, Helvetica, sans-serif;
  left: 10px; 
  top: 10px; 
  overflow: hidden; 
  width: 250px; 
  height: 350px;  //Mary 
}

.lineInfo { 
  font: 11px, Tahoma, Verdana, Helvetica, sans-serif;
  left: 10px; 
  top: 10px; 
  overflow: hidden;
  width: 200px; 
  height: 100px;  //Mary 
}

.pmLocate { 
  font: 11px, Tahoma, Verdana, Helvetica, sans-serif;
  left: 10px; 
  top: 10px; 
  overflow: auto; 
  width: 160px; 
  height: 20px; 
  background-color: #ccffcc; 
}

.posTip {
  padding: 2px;
  font: 11px, Tahoma, Verdana, Helvetica, sans-serif;
  background-color: #ffffcc;
  border: 2px solid white;
}

.poiFile a { text-decoration:none; }
.poiFile a:link { text-decoration:none; }
.poiFile a:visited { text-decoration:none; }

#sBar { 
  position: absolute; 
  bottom: 2px; 
  left: 2px; 
  padding: 1px;
  width: 200px;
  height: 21px;
  background: #ffffcc; 
  border: 1px solid #ffffcc; 
  font: 11px, Tahoma, Verdana, Helvetica, sans-serif; 
  overflow: hidden;
}

#sForm {
  width: 100%;
  font: 11px, Tahoma, Verdana, Helvetica, sans-serif;
}

a.squarebutton
{
	background: transparent url('http://www.iTravel-Tech.com/media/square-blue-left.gif') no-repeat top left;
	display: block;
	float: left;
	font: normal 10px Arial; /* Change 12px as desired */
	line-height: 15px; /* This value + 4px + 4px (top and bottom padding of SPAN) must equal height of button background (default is 23px) */
	height: 23px; /* Height of button background height */
	padding-left: 9px; /* Width of left menu image */
	text-decoration: none;
}

a:link.squarebutton, a:visited.squarebutton, a:active.squarebutton{
	color: #494949; /*button text color*/
}

a.squarebutton span{
	background: transparent url('http://www.iTravel-Tech.com/media/square-blue-right.gif') no-repeat top right;
	display: block;
	padding: 4px 9px 4px 0; /*Set 9px below to match value of 'padding-left' value above*/
}

a.squarebutton:hover{ /* Hover state CSS */
	background-position: bottom left;
}

a.squarebutton:hover span{ /* Hover state CSS */
	background-position: bottom right;
	color: black;
}

#ScreenCapture_buttonwrapper { /* Container you can use to surround a CSS button to clear float */
  position: absolute; 
  top: 10px; 
  left: 75px; 
  padding: 1px;
  width: 130px; 
}
</style> 
<!-- END HERE -->
<script src="https://maps.google.com/maps/api/js?sensor=false" type="text/javascript"></script>
<!-- embedded JSS file from "C:\PF\Utils\HOLUX ezTour21\web\js\gmap\stbl\EN.js" -->
<!-- START HERE -->
<script  type="text/javascript">
//<![CDATA[
//
// java script for itravel-tech gmap view's string table
// Language: English
//

var strTBar_Reload_Tip = "Reload";
var strTBar_SlideShow_Tip = "Slide Show";
var strTBar_AddPlaceMark_Tip = "Add Placemark";
var strTBar_AddDestination_Tip = "Add Finder";
var strInfoWin_Edit_Cmd = "Edit";
var strInfoWin_ScreenCapture = "Screen Capture...";
var strInfoWin_SaveAsTarget_Cmd = "Save As Target";
var strInfoWin_LineFit_Cmd = "Fit";
var strMsgCannotFindResult = "Can't find the result in Google Map!";
var strInfoWin_BackToInfoCmd = "Back to Info";
var strInfoWIn_ShowLocationCmd = "Show Location";
var strFailToLoadGoogleMap = '<h3>Failed to load Google Map!</h3>' 
+ '<p style="color: #990000"><b>The Internet Exporler on your machine seems not compatible with Google Map, please go through the following steps to verify.</b></p>' 
+ '<ul>'
+ '<li>Invoke IE to open "maps.google.com", please check you can see world map on IE or not?</li>'
+ '<li>If you use proxy, please disable it, and try again.</li>'
+ '<li>Please clean the cache file of IE, and try again.</li>'
+ '<li>Please update your IE to IE7 or above, and try again.</li>'
+ '</ul>'
+ '<br><br><center><input type=submit value="Reload Google Map again" onClick="location.href=\'CMD:ReloadGoogleMapPage\'"></form></center>';

//]]>
</script>
<!-- END HERE -->
<script src="map.files/web/js/imgctrl/lytebox.js" type="text/javascript"></script>
<!-- embedded JSS file from "C:\PF\Utils\HOLUX ezTour21\web\js\gmapV3\gmapviewV3.js" -->
<!-- START HERE -->
<script  type="text/javascript">
//<![CDATA[
// javascript & CSS include function
var getHead = function() { return document.getElementsByTagName("head")[0]; };
var includeJavascriptFile = function(url) {
        if (document.body == null) {
            var htmlString = "<script src='" + url;
            htmlString += "' type='text/javascript'" + ">";
            htmlString += "</" + "script>";
            document.write(htmlString);
        } else {
            var script = document.createElement("script");
            script.type = "text/javascript";
            script.language = "JavaScript";
            script.src = url;
            getHead().appendChild(script);
        }
    };
var includeCssFile = function(url) {
        if (document.body == null) {
            document.write("<link rel='stylesheet' href='" + url + "' type='text/css'/>");
        } else {
            var link = document.createElement("link");
            link.setAttribute("rel", "stylesheet");
            link.setAttribute("type", "text/css");
            link.setAttribute("href", url);
            getHead().appendChild(link);
        }
    };
 
//
// java script for itravel-tech gmap view's global variable
//
 
// for map
var gvbMapInit = false;
var gvbChinaMap = false;
var gvoMap = null;   // map object of gmap
var gvoGE = null;    // earth object of gmap
var gvoaMapTypes = null;     // map types of gmap
var gvnFitZoom = 14; // zoom level for fit window
var gvoFitBound = null;
var gvoEnableEarthView = false;
var gvoCurrMapType = null;
var gvoInfowindow = null;

// for search
var gvoLocalSearch = null;
var gvoSearchForm = null;
var gvoLocalSearchCtrl = null;

// refresh Google Map Timer
var gvoRefreshGoogleMapTimer = true;
var gvoRefreshTimeout = 30*60*1000; // 30mins
function SetRefreshTimer()
{
    if (gvoRefreshGoogleMapTimer == true)
        setTimeout("appReload();", gvoRefreshTimeout);
}


// include icon image URL JS file
var gvoIconImageURLPath = null;
includeJavascriptFile("http://www.iTravel-Tech.com/PhotoTagger/loadIconUrl.js");

// icons ...
var gvoLocateIcon = null;
var gvoLineIcon = null;
var gvoLineMinimapPOIIcon = null;
var gvoUserPOIIcon = null;
var gvoUserDestIcon = null;
var gvoSearchIcon = null;
var gvoGraphMarkerIcon1 = null;
var gvoGraphMarkerIcon2 = null;

// type icon marker
var gvoTypeIconMarkerAry = [];
var gvoTypeIconAry = [];

// markers ...
var gvoLocateMarker = null;
var gvoLocateLabel = null;
var gvoGraphMarker1 = null;
var gvoGraphMarker2 = null;

// tracker markers
var gvoTrackerMarkerAry = null;
var gvoTrackerMarkerIconAry = null;
var gvoLastVisibleTrackMarker = null;

// focus ...
var gvnCurZoom = 14; // zoom level for current window
var gvnCurPOIID = 0;
var gvnCurLineID = 0;
var gvoCenterPoint = null;
var gvoCurMapBounds = null; // full bounds of data
var gvsCurMapType = null;
var gvbBullonOnfocus = false;
var gvoAddPOI = {'mode':false, 'maker':null, 'moveHDL':null, 'clickHDL':null };

// default color array 
var gvoaColors = ['#5500ff','#ff007f','#555500','#aa55ff','#00aa7f','#aaaa00','#55ffff','#ffff7f','#550000','#00557f'];

// communicate with app
var gvsProductPath = null;
var gvbAppSelectFlag = false;
var gvnPoiType = 9;
var gvnLineType = 11;

// data
var gvoInitOption = null;
var gvoaMarkers = null;
var gvoaLines = null;
var gvoaIcons = [];

// trackList combo box
var gTrackListCmbBox = null;
var gPhotoListCtrl = null;

// viewing option
var gDisplayLogo = false;
var gDisplayLogoFileName = null;

// function option
var gCanAddDestination = false;
var gApJsCtrl = true;
var gvoEnableEarthView = true;
var gvoEnableEditMap = true;
//var gvoEnableScreenCapture = true;
var gvoEnableScreenCapture = false;
var gvoEnableGraphMarkers = false;

// debug
var gvbDebug = 0;

// define ObjectList class
var ObjectList = function(objectListBarIdName) {
    // private properties, e.g. strings to translate
    var m_objectListBarDom = document.getElementById(objectListBarIdName);
    
    var m_trackListDomId = 'trackSelect';
    var m_trackListDom = null;
    var m_allTracks = 'All Tracks';
    
    // private methods
	    
    return {       
        // public methods
        insertNewTrack: function(pnLine) {
            if (m_objectListBarDom.innerHTML == '') {
               m_trackListDom = document.createElement('select');
               m_trackListDom.setAttribute('id', m_trackListDomId);
               m_trackListDom.style.width = "175px";
               m_trackListDom.onchange = function() { gTrackListCmbBox.selectCurrentTrack(); };
               m_objectListBarDom.appendChild(m_trackListDom);
                    
               //var allTracksOption = new Option(m_allTracks, m_allTracks);
               //allTracksOption.id = m_allTracks;
               //m_trackListDom.add(allTracksOption, 0);
               //allTracksOption.selected = true;
            }
            var newTrackOptionDom = document.createElement('option');
            m_trackListDom.appendChild(newTrackOptionDom);
            newTrackOptionDom.setAttribute('id', 'track_'+pnLine.id);
            newTrackOptionDom.text = pnLine.name;
            newTrackOptionDom.value = pnLine.id;
        },
        updateCurrentSelection: function(pnLine) {
            if (!m_trackListDom)
                return -1;
            
            if (pnLine) {
                var i = 1;
                for (i = 1; i < m_trackListDom.length; i++) {
                    if (m_trackListDom.options[i].id == 'track_'+pnLine.id) {
                        m_trackListDom.selectedIndex = i;
                        return i;
                    }
                }
            } else {
                m_trackListDom.selectedIndex = 0;
            }
            return m_trackListDom.selectedIndex;
        },
        selectCurrentTrack: function() {
            if (!m_trackListDom)
                return;
                
            var optionValue = m_trackListDom.options[m_trackListDom.selectedIndex].value;
            //if (optionValue != m_allTracks) {
                onFitLine('gvnLineType', optionValue);
                var line = findLine(optionValue);
                if (line != null && line.startMarker != null) {
                    if (line.locationMarker != null) {
                        if (gvoLocateMarker != null) {
                            gvoLocateMarker.setVisible(false);
                        }
                        gvoLocateMarker = line.locationMarker;
                        gvoLocateMarker.setPosition(line.startMarker.getPosition());
                        gvoLocateMarker.setVisible(true);
                    }
                   google.maps.event.trigger(line.startMarker, "click");
                   var latlng = line.startMarker.getPosition();
                   onPosition(latlng.lat(), latlng.lng());
                }
            //} else {
            //    gvoMap.getInfoWindow().hide();
            //    var boundsCenter = gvoFitBound.getCenter();
            //    var fitZoomLevel = gvoMap.getBoundsZoomLevel(gvoFitBound);
            //    gvoMap.setCenter(boundsCenter, fitZoomLevel-1);
            //}
        }
    }
};

// define PhotoList class
var PhotoList = function(photoListWndId) {
    // private properties, e.g. strings to translate
    var m_photoListWndDom = document.getElementById(photoListWndId);
    
    // private methods
	    
    return {       
        // public methods
        insertNewPhoto: function(photoId, poiId) {
            var photoThumb = photoId.thumb;
            var photoTitle = photoId.title;
            var newLink = document.createElement('a');
            newLink.href = 'javascript:OnClick=gPhotoListCtrl.selectPhoto('+ poiId.id +')';
            newLink.title = photoTitle;
            newLink.className = 'toggleborder';
            
            //var newImage = document.createElement('img');
            var newImage = new Image();
            newImage.src = photoThumb;
            newImage.alt = photoTitle;
            newImage.border = "0px";
            newImage.style.padding = "1px 1px";
            
            newLink.appendChild(newImage);
            m_photoListWndDom.appendChild(newLink);
        },
        selectPhoto: function(poiId) {
            if (gvoInfowindow != null)
                gvoInfowindow.close();
            gvbBullonOnfocus = true; 
            onSelectPOI(gvnPoiType, poiId);
        },
        showPhotoList: function() {
            for (var i = 0; i< gvoaMarkers.length; i++) {
                var poPoi = gvoaMarkers[i];
                if (poPoi == null)
                    continue;
                for (var j=0; j < poPoi.photos.length; j++) {
                    if (poPoi.photos[j] == null)
                        continue;
                    this.insertNewPhoto(poPoi.photos[j], poPoi);
                }
            }
        }
    }
};

// functions ...
function initLayout() {
    if (gvbDebug == true) {
        includeJavascriptFile(gvsProductPath+"dump.js");
    }
    
    commSendCmd('onInitLayout');

    var voDivGmap = document.createElement('div');
    voDivGmap.setAttribute('id', 'gMap');
    document.body.appendChild(voDivGmap);

    if (gApJsCtrl == false) { // for export html
        // create photo list
        if (getPhotoNum() != 0) {
            var voPhotoList = document.createElement('div');
            voPhotoList.setAttribute('id', 'photoList');
            document.body.appendChild(voPhotoList);
            
            document.body.style.padding = "0 180px 0 0";
        } else {
            // remove slide show button
            gvoInitOption.tBar.funcSlideShow = false;
        }
        // create object list bar
        var voObjectListBar = document.createElement('div');
        voObjectListBar.setAttribute('id', 'objectListBar');
        document.body.appendChild(voObjectListBar);
        if (getPhotoNum() != 0) {
            voObjectListBar.style.right = "215px";
        } 
        gTrackListCmbBox = new ObjectList('objectListBar');
        gPhotoListCtrl = new PhotoList('photoList');
        gPhotoListCtrl.showPhotoList();
    } 
         
    //if (typeof(GMap2) != 'undefined') {
        // sBar
        //if (gvoInitOption.sBar == true) {
        //    var voDivSBar = document.createElement('div');
        //    voDivSBar.setAttribute('id', 'sBar');
        //    document.body.appendChild(voDivSBar);
        //    var voDivSForm = document.createElement('div');
        //    voDivSForm.setAttribute('id', 'sForm');
        //    voDivSBar.appendChild(voDivSForm);
        //}  
        if (gvoInitOption.enableScreenCapture != null)
            gvoEnableScreenCapture = gvoInitOption.ScreenCapture;
            
        if (gvoEnableScreenCapture) {
            appCreateScreenCaptureButton();    
        }
        
        if (gvoInitOption.enableGraphMarker != null)
            gvoEnableGraphMarkers = gvoInitOption.enableGraphMarker;
            
        if (gvoInitOption.tBar != null) {
            var voDivTBar = document.createElement('div');
            voDivTBar.setAttribute('id', 'tBar');
    
            // reload function
            //if (gvoInitOption.tBar.funcReload == true)
            //    voDivTBar.innerHTML = "<a href='javascript:OnClick=appReload()' title='Reload'><img src='"+gvsProductPath+"web/js/imgctrl/images/refresh.png' class='cButton' /></a>";
    
            // slideshow function
            if (gvoInitOption.tBar.funcSlideShow == true) {
                var tempHTML = "<a href='javascript:OnClick=actSlideShow()' title='"+strTBar_SlideShow_Tip+"'><img src='"+gvsProductPath+"web/js/imgctrl/images/show.png' class='cButton' /></a>";
                voDivTBar.innerHTML += tempHTML;
            }
      
            // add poi function
            if (gvoInitOption.tBar.funcAddPOI == true) {
                gvoUserPOIIcon = new google.maps.MarkerImage();
                if (gvoIconImageURLPath != null) {
                    gvoUserPOIIcon.url = gvoIconImageURLPath + "add_poi.png";
                } else {
                    gvoUserPOIIcon.url = "http://maps.google.com/mapfiles/kml/pal4/icon48.png";
                }
                gvoUserPOIIcon.size = new google.maps.Size(22, 22);
                gvoUserPOIIcon.anchor = new google.maps.Point(11, 21);
                
                var tempHTML = "<a href='javascript:OnClick=userPOI()' title='"+strTBar_AddPlaceMark_Tip+"'><img src='"+gvoUserPOIIcon.url+"' class='cButton' width=22 /></a>";
                voDivTBar.innerHTML += tempHTML;
            }
            
            // add destination function
            if (gCanAddDestination == true) {
                gvoUserDestIcon = new google.maps.MarkerImage();
                if (gvoIconImageURLPath != null) {
                    gvoUserDestIcon.url = gvoIconImageURLPath + "destination.png";
                } else {
                    gvoUserDestIcon.url = "http://maps.google.com/mapfiles/kml/pal4/icon49.png";
                }
                gvoUserDestIcon.size = new google.maps.Size(22, 22);
                gvoUserDestIcon.anchor = new google.maps.Point(11, 11);
                
                var tempHTML = "<a href='javascript:OnClick=userDest()' title='"+strTBar_AddDestination_Tip+"'><img src='"+gvoUserDestIcon.url+"' class='cButton' width=22 /></a>";
                voDivTBar.innerHTML += tempHTML;
            }
            
            if (gvoInitOption.tBar.funcSlideShow == true ||
                gvoInitOption.tBar.funcAddPOI == true ||
                gCanAddDestination == true) {
                document.body.appendChild(voDivTBar);
                
                if (getPhotoNum() != 0 && gApJsCtrl == false) {
                    voDivTBar.style.right = "190px";
                }
            }
        }
    //}
}

function initGData() {
    gvoLocateIcon = createIcon(gvoInitOption.iconPosOpt);
    gvoLineIcon = createIcon(gvoInitOption.iconLineOpt);
    gvoLineMinimapPOIIcon = createIcon(gvoInitOption.iconMinimapPoiOpt);

    gvoFitBound = new google.maps.LatLngBounds(new google.maps.LatLng(gvoInitOption.startLat, gvoInitOption.startLon), new google.maps.LatLng(gvoInitOption.startLat, gvoInitOption.startLon));
    gvoCenterPoint = new google.maps.LatLng(gvoInitOption.startLat, gvoInitOption.startLon);
  
    if (gApJsCtrl) {
        // Create "Search result" arrow marker icon
        gvoSearchIcon = new google.maps.MarkerImage();
        if (gvoIconImageURLPath != null) {
            gvoSearchIcon.url = gvoIconImageURLPath + "arrow_location.png";
        } else {
            gvoSearchIcon.url = "http://maps.google.com/mapfiles/kml/shapes/poi.png";
        }
        //gvoSearchIcon.shadow = "http://labs.google.com/ridefinder/images/mm_20_shadow.png";
        gvoSearchIcon.size = new google.maps.Size(23, 34);
        //gvoSearchIcon.shadowSize = new GSize(22, 20);
        gvoSearchIcon.anchor = new google.maps.Point(11, 33);
        //gvoSearchIcon.infoWindowAnchor = new GPoint(14, 1);
    }
    if (gvoEnableGraphMarkers) {
        gvoGraphMarkerIcon1 = new google.maps.MarkerImage();
        gvoGraphMarkerIcon1.url = "http://maps.google.com/mapfiles/kml/pal3/icon0.png";
        gvoGraphMarkerIcon1.size = new google.maps.Size(16, 16);
        gvoGraphMarkerIcon1.anchor = new google.maps.Point(7, 7);
        
        gvoGraphMarkerIcon2 = new google.maps.MarkerImage();
        gvoGraphMarkerIcon2.url = "http://maps.google.com/mapfiles/kml/pal3/icon1.png";
        gvoGraphMarkerIcon2.size = new google.maps.Size(16, 16);
        gvoGraphMarkerIcon2.anchor = new google.maps.Point(7, 7);
    }
}

function initTypeIconMarker() {
    // init line and type mapping
    if (gvoInitOption.iconTypeAryOpt != null) {
        var i = 0;
        for (i = 0; i < gvoInitOption.iconTypeAryOpt.length; i++) {
            gvoTypeIconAry[i] = createIcon(gvoInitOption.iconTypeAryOpt[i]);
            gvoTypeIconMarkerAry[i] = new google.maps.Marker({position: new google.maps.LatLng(0, 0), map: gvoMap, icon: gvoTypeIconAry[i], visible: false});
        }                     
    }
}

///////////////////////////////////////////////////////////////////////////////
/// MAIN FUNCTION
///////////////////////////////////////////////////////////////////////////////
function mapMain() {
    // init lytebox.
    myLytebox = new LyteBox();
    
    // init google map
    gvbMapInit = true;
  
    if (gvoLocateIcon == null)  initGData();
    
    // create google map
    var gMapOptions = {
      zoom: gvoInitOption.zoomLevel,
      center: gvoCenterPoint,
      mapTypeId: google.maps.MapTypeId.ROADMAP,
      scaleControl: true,
      overviewMapControl: gvoInitOption.mapOverview
    };
    gvoMap = new google.maps.Map(document.getElementById("gMap"), gMapOptions);
             
    if (gvoInitOption.enableEarthView != null)
        gvoEnableEarthView = gvoInitOption.enableEarthView;
//    if (gvoEnableEarthView == true)
//        gvoMap.addMapType(G_SATELLITE_3D_MAP);
    gvoaMapTypes = gvoMap.mapTypes;
    
    if (gvoInitOption.callByReload == true || (gvoaMarkers.length == 0 && gvoaLines.length == 0)) {
        gvnCurZoom = gvoInitOption.zoomLevel;
        gvnFitZoom = gvoInitOption.zoomLevel;
    } else {
        gvnCurZoom = gvoMap.getZoom();
        gvnFitZoom = gvnCurZoom;
    }
    
    gvoMap.setCenter(gvoCenterPoint);
    
    gvoMap.setZoom(gvnCurZoom);
    gvoCurMapBounds = gvoMap.getBounds();
    gvoCurrMapType = gvoMap.getMapTypeId();
    
    // Initialize the local searcher
    // create google search control
    //if (gvoInitOption.sBar == true) {
    //    // new Google Local Search Control
    //    var localSearchOptions = {
    //        onLocalSearchCompleteCallback : onLocalSearchSearchComplete,
    //        onGenerateMarkerHtmlCallback : onLocalSearchMarkerHtml
    //    };
    //    if (typeof(google) != 'undefined') {
    //        gvoLocalSearchCtrl = new google.maps.LocalSearch(localSearchOptions);
    //        //var localSearchCtrlPos = new GControlPosition(G_ANCHOR_BOTTOM_LEFT, new GSize(3, 35));
    //        //gvoMap.addControl(gvoLocalSearchCtrl, localSearchCtrlPos);
    //        gvoLocalSearchCtrl.focus();
    //    }
    //}
           
    initTypeIconMarker();
    drawLineMarkers();
    drawPointMarkers();
    
    if (window.attachEvent) { 
        window.attachEvent("onresize", function() { appZoomTo(); } ); 
    } else { 
        window.addEventListener("resize", function() { appZoomTo(); } , false); 
    } 
    google.maps.event.addListener(gvoMap, 'click', function (mouseEventObj) { 
        if (gvoInfowindow != null) {
            gvoInfowindow.close();
        }
    });
    google.maps.event.addListener(gvoMap, 'zoom_changed', function () { appZoomTo(); });
    google.maps.event.addListener(gvoMap, 'dragend', function () { appZoomTo(); });
    google.maps.event.addListener(gvoMap, 'mousemove', function (mouseEventObj) {
        if (gvoAddPOI != null && gvoAddPOI.mode == true)
            return;
        commSendCmd("mapMouseMove:"+mouseEventObj.latLng.lat()+":"+mouseEventObj.latLng.lng());
        if (gvoLocalSearchCtrl != null)
            gvoLocalSearchCtrl.focus();
    });
    google.maps.event.addListener(gvoMap, 'maptypeid_changed', function() {
        var currMapName = "OtherMap";
        switch (gvoMap.getMapTypeId()) {
            case google.maps.MapTypeId.ROADMAP:
                currMapName = "NormalMap";
                break;
            case google.maps.MapTypeId.SATELLITE:
                currMapName = "SatelliteMap";
                break;
            case google.maps.MapTypeId.HYBRID:
                currMapName = "HybridMap";
                break;
            case google.maps.MapTypeId.TERRAIN:
                currMapName = "PhysicalMap";
                break;
            default:
                break;
        }
        commSendCmd("mapTypeChanged:"+currMapName);
        gvoCurrMapType = gvoMap.getMapTypeId();
    });
    
    // for initial status
    if (gvoaMapTypes.length > 0) {
        if (gvsCurMapType)
            gvoMap.setMapType(findMapType(gvsCurMapType));
        else
            gvoMap.setMapType(findMapTypeByID(gvoInitOption.mapType));
    }
    
    if (gvnCurPOIID > 0)
        onSelectPOI(gvnPoiType, gvnCurPOIID);
            
    if (gvoInitOption.fitToTrack == true) {
        onFitLine('gvnLineType', null);
    }
        
    SetRefreshTimer();
    commSendCmd('onInitGMap');
}

function getPhotoNum()
{
    var nPhotoNum = 0;
    if (gvoaMarkers != null) {
        for (var i = 0; i< gvoaMarkers.length; i++) {
            var poPoi = gvoaMarkers[i];
            if (poPoi != null && poPoi.photos != null)
                nPhotoNum += poPoi.photos.length;
        }
    }
    
    return nPhotoNum;
}

///////////////////////////////////////////////////////////////////////////////
/// Functions for map drawing
///////////////////////////////////////////////////////////////////////////////
function createIcon(poIconOpt)
{       
    var icon = new google.maps.MarkerImage();
    if (gvoIconImageURLPath != null) {
        icon.url = gvoIconImageURLPath + poIconOpt.fileName;
    } else {
        icon.url = "http://maps.google.com/mapfiles/kml/pal5/icon13.png";
    }
    icon.size = new google.maps.Size(poIconOpt.width, poIconOpt.height);
    icon.anchor = new google.maps.Point(poIconOpt.anchorX, poIconOpt.anchorY);
    //icon.infoWindowAnchor = new GPoint(poIconOpt.width/2, poIconOpt.height/2);
    return icon;
}

function createLineMarker(poLine) {
    var markerOptions = { position: new google.maps.LatLng(poLine.startLat, poLine.startLon), title: poLine.name, icon: gvoLineIcon };
    var marker = new google.maps.Marker(markerOptions);
    
    var infowindowOptions = {content: infoLine(poLine), pixelOffset: new google.maps.Size(0, gvoLineIcon.size.height/2)};
    var infowindow = new google.maps.InfoWindow(infowindowOptions);
    marker.infowindow = infowindow;
    google.maps.event.addListener(infowindow, "closeclick", function() {
        gvoInfowindow = null;
    });
    google.maps.event.addListener(infowindow, 'domready', function() {
		var lat = poLine.startLat;
		var lng = poLine.startLon;

        var nZoomLevel = gvoMap.getZoom()+3;
        if (nZoomLevel > 18)
            nZoomLevel = gvoMap.getZoom()-3;
        var minimapDiv = document.getElementById("minimap");
        var gMapOptions = {
            zoom: nZoomLevel,
            center: marker.getPosition(),
            mapTypeId: google.maps.MapTypeId.ROADMAP
        };
        var minimap = new google.maps.Map(minimapDiv, gMapOptions);
        
        var miniMapMarkerOptions = { position: new google.maps.LatLng(lat, lng), title: poLine.name, icon: gvoLineIcon };
        var miniMapMarker = new google.maps.Marker(miniMapMarkerOptions);
        miniMapMarker.setMap(minimap);
    });
    
    google.maps.event.addListener(marker, "click", function() {
        if (gvoInfowindow != null)
            gvoInfowindow.close();
        
        infowindow.open(gvoMap, marker);
        gvoInfowindow = infowindow;
    });
    poLine.startMarker = marker;
    
    // assign line location marker
    // -- gvoTypeIconMarkerAry
    // -- gvoTypeIconAry
    if (gvoInitOption.trackTypeMappingAry != null) {
        var i = 0;
        for (i = 0; i < gvoInitOption.trackTypeMappingAry.length; i++) {
            if (poLine.name == gvoInitOption.trackTypeMappingAry[i].trackName) {
                poLine.locationMarker = gvoTypeIconMarkerAry[gvoInitOption.trackTypeMappingAry[i].type];
                break;
            }
        }                     
    }
    return marker;
}

function drawLineMarkers() {
    if (gvoMap == null)
        return;
        
    if (gvoaLines.length > 0) {
        for (var i=0; i<gvoaLines.length; i++) {
            var lineMarker = createLineMarker(gvoaLines[i]);
            lineMarker.setMap(gvoMap);

            var linePath = new google.maps.MVCArray();
            if (gvoaLines[i].pathAry != null) {
                for (var wpIdx=0; wpIdx < gvoaLines[i].pathAry.length; wpIdx++) {
                    var wp = new google.maps.LatLng(gvoaLines[i].pathAry[wpIdx][0], gvoaLines[i].pathAry[wpIdx][1]);
                    linePath.push(wp);
                }
            }

            var polyline;
            if (gvoaLines[i].width > 0)
                polyline = new google.maps.Polyline({path: linePath, strokeColor: gvoaLines[i].color, strokeWeight: gvoaLines[i].width, strokeOpacity:0.7});
            else
                polyline = new google.maps.Polyline({path: linePath, strokeColor: colors[i%10], strokeWeight: 5, strokeOpacity:0.7});
        
            gvoaLines[i].marker = polyline;
            polyline.setMap(gvoMap);
            
            if (gApJsCtrl == false) // export html
                gTrackListCmbBox.insertNewTrack(gvoaLines[i]);
        }
        if (gApJsCtrl == false) {
            gTrackListCmbBox.selectCurrentTrack();
        }
    }
}

function onClickMarker(marker, poPoi) {
    if (gvoMap == null)
        return;
        
    var bDestMarker = false;
    if (marker.getIcon() == gvoUserDestIcon)
        bDestMarker = true;
        
    if (gvoLocateMarker == null) { 
        var markerOptions = { position: marker.getPosition(), icon: gvoLocateIcon, clickable: false };
        gvoLocateMarker = new google.maps.Marker(markerOptions); 
        gvoLocateMarker.setMap(gvoMap);
    } else {
        gvoLocateMarker.setPosition(marker.getPosition());
    }
        
    //marker.openInfoWindowTabsHtml(infoMarker(poPoi, bDestMarker));
    //bindMiniMap(marker);
    gvbBullonOnfocus = true;
    myLytebox.updateLyteboxItems();
    if (gvnCurPOIID != poPoi.id) {
        gvnCurPOIID = poPoi.id;
        if (gvbAppSelectFlag == false) { 
            commSendCmd('onSelectPOI:'+gvnPoiType+':'+poPoi.id); 
        } else { 
            gvbAppSelectFlag = false; 
        }
    }
}

function createMarker(poPos, poPoi, icon) {
    if (gvoMap == null)
        return;
        
    if (icon == null && poPoi.icon != null) {
        if (gvoaIcons[poPoi.icon] == null) {
            // create icon
            icon = new google.maps.MarkerImage();
            if (gvoIconImageURLPath != null) {
                icon.url = gvoIconImageURLPath + poPoi.icon;
            } else {
                icon.url = "http://maps.google.com/mapfiles/kml/pal5/icon14.png";
            }
            icon.size = new google.maps.Size(32, 32);
            icon.anchor = new google.maps.Point(16, 16);
            //icon.infoWindowAnchor = new GPoint(16, 16);
                
            gvoaIcons[poPoi.icon] = icon;
        } else {
            icon = gvoaIcons[poPoi.icon];
        }
    }
    var markerOptions = { position: poPos, title: poPoi.name, icon: icon };
    var marker = new google.maps.Marker(markerOptions);
    poPoi.marker = marker;

//     if (gvoLocateMarker == null) { 
//         gvoLocateMarker = new GMarker(marker.getPoint(), gvoLocateIcon); 
//         gvoMap.addOverlay(gvoLocateMarker); 
//     }
    
    var bDestMarker = false;
    if (marker.getIcon() == gvoUserDestIcon)
        bDestMarker = true;
        
    var infowindowOptions = {content: infoMarker(poPoi, bDestMarker), pixelOffset: new google.maps.Size(0, icon.size.height/2)};
    var infowindow = new google.maps.InfoWindow(infowindowOptions);
    marker.infowindow = infowindow;
    google.maps.event.addListener(infowindow, "closeclick", function() {
        gvoInfowindow = null;
    });
    
    //marker.bindInfoWindowTabsHtml(infoMarker(poPoi, bDestMarker));
    //marker.bindInfoWindowHtml(infoMarker(poPoi, bDestMarker));
    //myLytebox.updateLyteboxItems(); 
    
    google.maps.event.addListener(marker, "click", function() {
        onClickMarker(marker, poPoi);
        //bindMiniMap(marker);
        
        if (gvoInfowindow != null)
            gvoInfowindow.close();
        
        infowindow.open(gvoMap, marker);
        gvoInfowindow = infowindow;
    });
  
//     google.maps.event.addListener(marker, "dblclick", function() {
//         var point = marker.getPosition();
//         
//         if (gvoLocateMarker == null) {
//             var markerOptions = { position: marker.getPosition(), icon: gvoLocateIcon, clickable: false }; 
//             gvoLocateMarker = new google.maps.Marker(markerOptions);
//             gvoLocateMarker.setMap(gvoMap);
//         } else {
//             gvoLocateMarker.setPosition(point);
//         }
// 
//         if (wndPanCheck(point.lat(), point.lng()) == true) gvoMap.panTo(point); 
//     });
        
    return marker;
}

function drawPointMarkers() {
    if (gvoMap == null)
        return;
        
    if (gvoaMarkers.length > 0) {
        for (var i=0; i<gvoaMarkers.length; i++) {
            var icon = null;
            if (gvoaMarkers[i].isdest == true)
                icon = gvoUserDestIcon;
            var lat = gvoaMarkers[i].lat;
            var lng = gvoaMarkers[i].lon;

            var marker = createMarker(new google.maps.LatLng(lat, lng), gvoaMarkers[i], icon);
            marker.setMap(gvoMap);
        }
    }
}

function bindMiniMap(marker) {
    var nZoomLevel = gvoMap.getZoom()+3;
    if (nZoomLevel > 18)
        nZoomLevel = gvoMap.getZoom()-3;
        
    var minimapDiv = document.getElementById("minimap");
    var gMapOptions = {
      zoom: nZoomLevel,
      center: marker.getPosition(),
      mapTypeId: google.maps.MapTypeId.ROADMAP
    };
    var minimap = new google.maps.Map(minimapDiv, gMapOptions);
//    var CopyrightDiv = minimapDiv.firstChild.nextSibling;
//     var CopyrightImg = minimapDiv.firstChild.nextSibling.nextSibling;
//  	CopyrightDiv.style.display = "none"; 
//  	CopyrightImg.style.display = "none";	
 
    var markerOptions = { position: marker.getPosition(), title: marker.getTitle(), icon: marker.getIcon() };
    var miniMapMarker = new google.maps.Marker(markerOptions);
    miniMapMarker.setMap(minimap);
    
    return minimap;
}

function infoSearchResultMarker(poSearchResult) {
     var info = '<div class="pmInfo" style="width: 230px; height: 270px; overflow: hidden;">';
   
     if (poSearchResult != null) {
         if (poSearchResult.titleNoFormatting  != null) {
            info += '<b>'+poSearchResult.titleNoFormatting+'</b><br />';
            var strDescHtmlFormat = '';
            if (poSearchResult.streetAddress != null) {
                strDescHtmlFormat += poSearchResult.streetAddress+'<br />'; 
            }
            if (poSearchResult.city != null && poSearchResult.city != "") {
                strDescHtmlFormat += poSearchResult.city+' '; 
            }
            if (poSearchResult.region != null && poSearchResult.region != "") { 
                strDescHtmlFormat += poSearchResult.region+'<br />'; 
            }
            if (poSearchResult.country != null && poSearchResult.country != "") { 
                strDescHtmlFormat += poSearchResult.country+'<br />'; 
            }
            if (poSearchResult.phoneNumbers != null && poSearchResult.phoneNumbers[0] !=null) {
                strDescHtmlFormat += poSearchResult.phoneNumbers[0].number+'<br />'; 
            }
            
            var lat = poSearchResult.lat;
            var lng = poSearchResult.lng;
            
            if (gvoInitOption.poiCmd.funcEdit == true)
                info += '<a href="javascript:OnClick=appAddSearchResultAsPOI(\''+poSearchResult.titleNoFormatting+'\',\''+lat+'\',\''+lng+'\', false,\''+strDescHtmlFormat+'\')">'+strTBar_AddPlaceMark_Tip+'</a>';        
            if (gvoInitOption.poiCmd.funcSaveAsTarget == true)
                info += ' - <a href="javascript:OnClick=appAddSearchResultAsPOI(\''+poSearchResult.titleNoFormatting+'\',\''+lat+'\',\''+lng+'\', true,\''+strDescHtmlFormat+'\')">'+strInfoWin_SaveAsTarget_Cmd+'</a>';

            info +='<br /><br /><div class="poiFiles">';
            info += strDescHtmlFormat;
       
            info = info+'</div>';
            info += '<br /><div id="minimap" style="width: 200px; height: 150px; overflow: hidden;"></div>';
         }
     } 
   
     info += '</div>'; 
     
     return info; 
}

function onLocalSearchMarkerHtml(marker, html, result) {
    var info = '<div class="pmInfo" style="width: 230px; height: 270px; overflow: hidden; ">';
   
    if (result != null) {
         if (result.titleNoFormatting  != null) {
            info += '<b>'+result.titleNoFormatting+'</b><br />';
            var strDescHtmlFormat = '';
            if (result.streetAddress != null) {
                strDescHtmlFormat += result.streetAddress+'<br />'; 
            }
            if (result.city != null && result.city != "") {
                strDescHtmlFormat += result.city+' '; 
            }
            if (result.region != null && result.region != "") { 
                strDescHtmlFormat += result.region+'<br />'; 
            }
            if (result.country != null && result.country != "") { 
                strDescHtmlFormat += result.country+'<br />'; 
            }
            if (result.phoneNumbers != null && result.phoneNumbers[0] !=null) {
                strDescHtmlFormat += result.phoneNumbers[0].number+'<br />'; 
            }
            
            var lat = result.lat;
            var lng = result.lng;
                  
            if (gvoInitOption.poiCmd.funcEdit == true)
                info += '<a href="javascript:OnClick=appAddSearchResultAsPOI(\''+result.titleNoFormatting+'\',\''+lat+'\',\''+lng+'\', false,\''+strDescHtmlFormat+'\')">'+strTBar_AddPlaceMark_Tip+'</a>';        
            
            if (gCanAddDestination == true)
                info += ' - <a href="javascript:OnClick=commSendCmd(\'UserAddDest:'+lat+':'+lng+':'+strDescHtmlFormat+'\')">'+strTBar_AddDestination_Tip+'</a>';
            
            if (gvoInitOption.poiCmd.funcSaveAsTarget == true)
                info += ' - <a href="javascript:OnClick=appAddSearchResultAsPOI(\''+result.titleNoFormatting+'\',\''+lat+'\',\''+lng+'\', true,\''+strDescHtmlFormat+'\')">'+strInfoWin_SaveAsTarget_Cmd+'</a>';

            info +='<br /><br /><div class="poiFiles">';
            info += strDescHtmlFormat;
       
            info = info+'</div>';
            info += '<br /><div id="minimap" style="width: 200px; height: 150px; overflow: hidden; "></div>';
         }
     } 
   
     info += '</div>'; 
     html.innerHTML = info;
          
//     GEvent.addListener(marker, "infowindowopen", function() {
//        bindMiniMap(marker);
//     });    
         
     return html; 
}

function onLocalSearchSearchComplete(searcher) {
    if (gvoMap == null)
        return;
        
    if (gvbMapInit == false || !searcher.results || searcher.results[0]==null)
        return;
    
    gvoMap.setCenter(new google.maps.LatLng(parseFloat(searcher.results[0].lat), parseFloat(searcher.results[0].lng)));
    gvoMap.setZoom(14);
}

///////////////////////////////////////////////////////////////////////////////
/// Functions for string procedure
///////////////////////////////////////////////////////////////////////////////
function jstringToHtml(jstring) {
    // remove new line from the end of string!
    while(jstring.charAt(jstring.length-1) == '\n' || jstring.charAt(jstring.length-1) == '\r')
    {  
        jstring = jstring.substring(0,jstring.length-1);
    }
    jstring = jstring.replace(/</g, '&lt;');
    jstring = jstring.replace(/>/g, '&gt;');
    jstring = jstring.replace(/\n/g,'<br />');
    return jstring;
}

///////////////////////////////////////////////////////////////////////////////
/// Functions for focus on
///////////////////////////////////////////////////////////////////////////////

function onLocalSearch() {
    if (gvoMap == null)
        return;
        
    if (gvbMapInit == false) return;
    
    if (!gvoLocalSearch.results || gvoLocalSearch.results[0]==null) {
        alert(strMsgCannotFindResult);
        return;
    }
        
    gvoMap.setCenter(new google.maps.LatLng(parseFloat(gvoLocalSearch.results[0].lat), parseFloat(gvoLocalSearch.results[0].lng)));
    gvoMap.setZoom(14);
    
    // create arrow location icon marker
    var markerOptions = { 
        position: new google.maps.LatLng(parseFloat(gvoLocalSearch.results[0].lat), parseFloat(gvoLocalSearch.results[0].lng)), 
        title: gvoLocalSearch.results[0].titleNoFormatting, 
        icon: gvoSearchIcon 
    };
    var locationMarker = new google.maps.Marker(markerOptions);
    locationMarker.setMap(gvoMap);
    
    var infowindowOptions = {
        content: infoSearchResultMarker(gvoLocalSearch.results[0]), 
        pixelOffset: new google.maps.Size(0, gvoSearchIcon.size.height/2)
    };
    var infowindow = new google.maps.InfoWindow(infowindowOptions);
    google.maps.event.addListener(infowindow, "closeclick", function() {
        gvoInfowindow = null;
    });
    google.maps.event.addListener(infowindow, 'domready', function() {
        bindMiniMap(locationMarker);
    });
        
    if (gvoInfowindow != null)
        gvoInfowindow.close();
    infowindow.open(gvoMap, locationMarker);
    gvoInfowindow = infowindow;
    
    google.maps.event.addListener(locationMarker, "click", function() {
        if (gvoInfowindow != null)
            gvoInfowindow.close();
        
        infowindow.open(gvoMap, locationMarker);
        gvoInfowindow = infowindow;
    });
    
    locationMarker.result = gvoLocalSearch.results[0];
}

function onSearchForm(searchForm) {
    if (gvoMap == null)
        return;
        
    if (gvbMapInit == false) return false;
    
    gvoLocalSearch.execute(searchForm.input.value);
    return false;
}

function onAddDest(pjsonPOI) {
    if (gvoMap == null)
        return;
        
    if (gvbMapInit == false) return;
    
    var poi = eval('('+pjsonPOI+')');
    
    var lat = poi.lat;
    var lng = poi.lon;

            
    var marker = createMarker(new google.maps.LatLng(lat, lng), poi, gvoUserDestIcon);
    marker.setMap(gvoMap);
    gvoaMarkers.push(poi);
}

function onSelectLine(pnLineTyoe, pnLineID) {
    if (gvoMap == null)
        return;
        
    if (gvbMapInit == false) return;

    var line = findLine(pnLineID);
  
    if (line != null) {
        var point = new google.maps.LatLng(line.startLat, line.startLon); 
        gvoMap.panTo(point);
        
        if (gApJsCtrl == false) // export html
            gTrackListCmbBox.updateCurrentSelection(gvoaLines[i]);
    }
}

function onToggleTrackDisplay(sToggleTrackDisplayAryJson) {
    //alert(sToggleTrackDisplayAryJson);
    var _toggleTrackDisplayAry = eval('('+sToggleTrackDisplayAryJson+')');
    
    for (var i = 0; i < _toggleTrackDisplayAry.length; i++) {
        var line = findLine(_toggleTrackDisplayAry[i].id);
        if (line != null) {
            if (_toggleTrackDisplayAry[i].check == "false")
                line.marker.setVisible(false);
            else
                line.marker.setVisible(true);
        }
    }
}

function onFitLine(pnLineTyoe, pnLineID) {
    if (gvoMap == null)
        return;
        
    if (gvbMapInit == false) return;

    var line = findLine(pnLineID);
  
    if (line != null) {
        var lineBound = new google.maps.LatLngBounds(new google.maps.LatLng(line.minLat,line.minLon), new google.maps.LatLng(line.maxLat,line.maxLon));
        gvoCenterPoint = new google.maps.LatLng((line.minLat+line.maxLat)/2, (line.minLon+line.maxLon)/2);
        gvoMap.fitBounds(lineBound);
        gvnCurZoom = gvoMap.getZoom();
        gvoMap.setCenter(gvoCenterPoint);
        gvoCurMapBounds = gvoMap.getBounds();
    } else { // fit all tracks
        if (gvoaLines && gvoaLines.length > 0) {
            var lineBound = null;
            for (var i=0; i<gvoaLines.length; i++) {
                line = gvoaLines[i];
                if (line.minLat <= -1000 || line.minLon <= -1000 || line.maxLat <= -1000 || line.maxLon <= -1000)
                    continue;
                    
                if (i == 0) {
                    lineBound = new google.maps.LatLngBounds(new google.maps.LatLng(line.minLat,line.minLon), new google.maps.LatLng(line.maxLat,line.maxLon));
                } else {
                    lineBound.extend(new google.maps.LatLng(line.minLat,line.minLon));
                    lineBound.extend(new google.maps.LatLng(line.maxLat,line.maxLon));
                }
            }
            gvoMap.fitBounds(lineBound);
            gvnCurZoom = gvoMap.getZoom();
            gvoMap.setCenter(gvoCenterPoint);
            gvoCurMapBounds = gvoMap.getBounds();
        }
    }
    
    var newCP = gvoMap.getCenter();
    var mZoom = gvoMap.getZoom(); 
    commSendCmd("wndZoomTo:"+newCP.lat()+":"+newCP.lng()+":"+mZoom);
}

function onUpdateMarker(psMarkerJson) {
    if (gvoMap == null || gvbMapInit == false || gvoEnableGraphMarkers == false)
        return;
        
    var markerInfo = eval('('+psMarkerJson+')');
    var marker1Pos = new google.maps.LatLng(markerInfo.Marker1Lat, markerInfo.Marker1Lng);
    var marker2Pos = new google.maps.LatLng(markerInfo.Marker2Lat, markerInfo.Marker2Lng);

    if (gvoGraphMarker1 == null) { 
        var markerOptions = { position: marker1Pos, title: markerInfo.Marker1, icon: gvoGraphMarkerIcon1 };
        gvoGraphMarker1 = new google.maps.Marker(markerOptions); 
        gvoGraphMarker1.setMap(gvoMap); 
    } else {
        var lastPos = gvoGraphMarker1.getPosition();
        gvoGraphMarker1.setPosition(marker1Pos);
        if ((lastPos.lat() != marker1Pos.lat() || lastPos.lng() != marker1Pos.lng()) &&
            wndPanCheck(marker1Pos.lat(), marker1Pos.lng()) == true) {
            gvoMap.panTo(marker1Pos); 
        }
    }
    if (gvoGraphMarker2 == null) {
        var markerOptions = { position: marker2Pos, title: markerInfo.Marker2, icon: gvoGraphMarkerIcon2 }; 
        gvoGraphMarker2 = new google.maps.Marker(markerOptions); 
        gvoGraphMarker2.setMap(gvoMap); 
    }   else {
        var lastPos = gvoGraphMarker2.getPosition();
        gvoGraphMarker2.setPosition(marker2Pos);
        if ((lastPos.lat() != marker2Pos.lat() || lastPos.lng() != marker2Pos.lng()) &&
            wndPanCheck(marker2Pos.lat(), marker2Pos.lng()) == true) {
            gvoMap.panTo(marker2Pos); 
        }
    }
}

function onEditLine(psLineJson) {
    if (gvoMap == null)
        return;
        
    if (gvbMapInit == false) return;
    
    var newLine = eval('('+psLineJson+')');
    var pnID = newLine.id;
    
    if (pnID != null) {
        var lineAInd = findLineIndex(pnID);
        if (lineAInd != -1) {
            // remove overlap
			gvoaLines[lineAInd].startMarker.setMap(null);
            gvoaLines[lineAInd].startMarker = null;
            
			gvoaLines[lineAInd].marker.setMap(null);
            gvoaLines[lineAInd].marker = null;
            
            // reset to new!
            gvoaLines[lineAInd] = newLine;
            
            // new start marker
            var sMarker = createLineMarker(gvoaLines[lineAInd]);
            sMarker.setMap(gvoMap);
            
            // new line marker
            var linePath = new google.maps.MVCArray();
            if (gvoaLines[lineAInd].pathAry != null) {
                for (var wpIdx=0; wpIdx < gvoaLines[lineAInd].pathAry.length; wpIdx++) {
                    var wp = new google.maps.LatLng(gvoaLines[lineAInd].pathAry[wpIdx][0], gvoaLines[lineAInd].pathAry[wpIdx][1]);
                    linePath.push(wp);
                }
            }

            var polyline;
            if (gvoaLines[lineAInd].width > 0)
                polyline = new google.maps.Polyline({path: linePath, strokeColor: gvoaLines[lineAInd].color, strokeWeight: gvoaLines[lineAInd].width, strokeOpacity:0.7});
            else
                polyline = new google.maps.Polyline({path: linePath, strokeColor: colors[lineAInd%10], strokeWeight: 5, strokeOpacity:0.7});
            polyline.setMap(gvoMap);     
            gvoaLines[lineAInd].startMarker = sMarker;
            gvoaLines[lineAInd].marker = polyline;
        }
    }
}

function onDelLine(psLineID) {
    if (gvoMap == null)
        return;
        
    if (gvbMapInit == false) return;
    
    var pnLineID = Number(psLineID);
    removeLine(pnLineID);
}

function onAddLine(psLineJson) {
    if (gvoMap == null)
        return;
        
    if (gvbMapInit == false) return;
    
    var objLine = eval('('+psLineJson+')');
    objLine.startMarker = createLineMarker(objLine);
    objLine.startMarker.setMap(gvoMap);
    
    var linePath = new google.maps.MVCArray();
    if (objLine.pathAry != null) {
        for (var wpIdx=0; wpIdx < objLine.pathAry.length; wpIdx++) {
            var wp = new google.maps.LatLng(objLine.pathAry[wpIdx][0], objLine.pathAry[wpIdx][1]);
            linePath.push(wp);
        }
    }

    if (objLine.width > 0)
        objLine.marker = new google.maps.Polyline({path: linePath, strokeColor: objLine.color, strokeWeight: objLine.width, strokeOpacity:0.7});
    else
        objLine.marker = new google.maps.Polyline({path: linePath, strokeColor: colors[gvoaLines.length%10], strokeWeight: 5, strokeOpacity:0.7});
    objLine.marker.setMap(gvoMap); 
    gvoaLines.push(objLine);
}

function onReplaceAllLines(psLinesJson) {
    if (gvoMap == null)
        return;
        
    if (gvbMapInit == false) return;
    
    if (gvoaLines && gvoaLines.length > 0) {
        for (var i=0; i<gvoaLines.length; i++) {
            if (gvoaLines[i].marker) {
                gvoaLines[i].startMarker.setMap(null);
                gvoaLines[i].marker.setMap(null);
                gvoaLines[i].marker = null;
            }
        }
    }
    gvoaLines = eval('('+psLinesJson+')');
    drawLineMarkers();
}

function onSelectPOI(pnType, pnID) {
    if (gvoMap == null)
        return;
        
    if (gvbMapInit == false) return;

    gvbAppSelectFlag = true;
    var poi = findPOI(pnID);
  
    if (poi != null && poi.marker != null){ 
        if (gvoLocateMarker == null) { 
            var markerOptions = { position: poi.marker.getPosition(), icon: gvoLocateIcon, clickable: false };
            gvoLocateMarker = new google.maps.Marker(markerOptions); 
            gvoLocateMarker.setMap(gvoMap);
        } else {
            gvoLocateMarker.setPosition(poi.marker.getPosition());
        }
    
        //google.maps.event.trigger(poi.marker, "dblclick"); 
        if (gvbBullonOnfocus == true) {
        	google.maps.event.trigger(poi.marker, "click");
        }
    }
}

function onBindMiniMap(pnType, pnID) {
    if (gvoMap == null)
        return;
        
    if (gvbMapInit == false) return;
    var poi = findPOI(pnID);
    if (poi != null && poi.marker != null){ 
        if (gvbBullonOnfocus == true) {
            google.maps.event.trigger(poi.marker, "click");
        }
    }
}

function OnUpdatePoiInfoWindow(pnType, pnID) {
    if (gvoMap == null)
        return;
        
    if (gvnCurPOIID != pnID)
        return;
 
    var poi = findPOI(pnID);
    var _bullOnFocus = gvbBullonOnfocus;
    if (poi != null && poi.marker != null) {
        //if (_bullOnFocus == true) {
        //    poi.marker.closeInfoWindow();
        //    poi.marker.bindInfoWindow(null));
        //}
        
        //if (_bullOnFocus != true) {
        //    poi.marker.bindInfoWindow(infoMarker(poi));
       // }
        
        //google.maps.event.trigger(poi.marker, "dblclick");
        if (_bullOnFocus == true) {
           google.maps.event.trigger(poi.marker, "click");             
        }
        
        // restore status
        gvnCurPOIID = pnID;
        gvbBullonOnfocus = _bullOnFocus;
    }
}

function onAddPOI(pjsonPOI) {
    if (gvoMap == null)
        return;
        
    if (gvbMapInit == false) return;
    
    var poi = eval('('+pjsonPOI+')');
    var lat = poi.lat;
    var lng = poi.lon;

    var marker = createMarker(new google.maps.LatLng(lat, lng), poi, null);
    marker.setMap(gvoMap);
    gvoaMarkers.push(poi);
}

function onEditPOI(psPoiJSON) {
    if (gvoMap == null)
        return;
        
    if (gvbMapInit == false) return;
    
    var focusPOIID = gvnCurPOIID;
    var focusOn = gvbBullonOnfocus;
    var newPOI = eval('('+psPoiJSON+')');
    var pnID = newPOI.id;
    
    if (pnID != null) {
		var poiIndex = findPOIIndex(pnID);
        if (poiIndex != -1) {
            var icon = null; 
            // remove overlap
            if (gvoaMarkers[poiIndex].marker) {
                icon = gvoaMarkers[poiIndex].marker.getIcon();
                gvoaMarkers[poiIndex].marker.setMap(null);
                gvoaMarkers[poiIndex].marker = null;
            }
        
            gvoaMarkers[poiIndex] = newPOI;
            gvoaMarkers[poiIndex].marker = createMarker(new google.maps.LatLng(newPOI.lat, newPOI.lon), gvoaMarkers[poiIndex], icon);
            gvoaMarkers[poiIndex].marker.setMap(gvoMap);
            
			if (focusPOIID == pnID && focusOn == true) {
				google.maps.event.trigger(gvoaMarkers[poiIndex].marker, "click");
            }
        }
    }
}

function onDelPOI(psID) {
    if (gvoMap == null)
        return;
        
    if (gvbMapInit == false) return;
    
    var pnPOIID = Number(psID);
    removePOI(pnPOIID);
}

function onReplaceAllPOIs(psPOIsJson) {
    if (gvoMap == null)
        return;
        
    if (gvbMapInit == false) return;
    
    if (gvoaMarkers && gvoaMarkers.length > 0) {
        for (var i=0; i<gvoaMarkers.length; i++) {
            if (gvoaMarkers[i].marker) {
                gvoaMarkers[i].marker.setMap(null);
                gvoaMarkers[i].marker = null;
            }
        }
    }
    
    gvoaMarkers = eval('('+psPOIsJson+')');
    drawPointMarkers();
}

function onPosition(psLat, psLng) { 
    if (gvoMap == null)
        return;
        
    if (gvbMapInit == false) return;
    
    var latLng = new google.maps.LatLng(Number(psLat), Number(psLng));
    if (gvoLocateMarker == null) {
        var markerOptions = { position: latLng, icon: gvoLocateIcon, clickable: false };
        gvoLocateMarker = new google.maps.Marker(markerOptions); 
        gvoLocateMarker.setMap(gvoMap);
    } else {
        gvoLocateMarker.setPosition(latLng);
    }
         
    if (wndPanCheck(latLng.lat(), latLng.lng()) == true) 
        gvoMap.panTo(latLng); 
}

function onTracker(psLat, psLng, nMarkerNo) { 
    if (gvoMap == null || gvbMapInit == false || gvoTrackerMarkerAry == null) return;
    
    if (nMarkerNo == -1) { // hide last tracker marker
        gvoLastVisibleTrackMarker.setVisible(false);
        gvoLastVisibleTrackMarker = null;
    }
    
    if (gvoTrackerMarkerAry != null) { 
        if (gvoLastVisibleTrackMarker != null)
            gvoLastVisibleTrackMarker.hide();
       
        gvoLastVisibleTrackMarker = gvoTrackerMarkerAry[nMarkerNo];
        var point = new google.maps.LatLng(Number(psLat), Number(psLng));     
        gvoLastVisibleTrackMarker.setPosition(point);
        gvoLastVisibleTrackMarker.setVisible(true);
        if (wndPanCheck(point.lat(), point.lng()) == true) 
            gvoMap.panTo(point); 
        if (gvoMap.getZoom() < 12)
            gvoMap.setZoom(12);
    }
}

function onUpdateTrackerMarker(psTrackerMarkerJson) {
    if (gvoMap == null || gvbMapInit == false)
        return;
        
    gvoTrackerMarkerAry = [];
    var trackerMarkerAry = eval('('+psTrackerMarkerJson+')');
    for (var i=0; i < trackerMarkerAry.length; i++) {
        var info = trackerMarkerAry[i];
        // create icon
        var icon = new google.maps.MarkerImage();
        icon.url = info.path + info.fileName;
        icon.size = new google.maps.Size(info.width, info.height);
        icon.anchor = new google.maps.Point(info.anchorX, info.anchorY);
        //icon.infoWindowAnchor = new GPoint(info.width/2, info.height/2);
        
        // create marker
        var markerOption = { position: new google.maps.LatLng(0, 0), icon: icon, map: gvoMap, visible: false };
        gvoTrackerMarkerAry[i] = new google.maps.Marker(markerOption);
    }    
}

// function onTip(psLat, psLon, psMsg) {
//     if (gvbMapInit == false) return;
//     
//     if (gvoLocateLabel != null) {
//         gvoMap.removeTLabel(gvoLocateLabel);
//     }
//   
//     gvoLocateLabel = new TLabel();
//     gvoLocateLabel.id = 'l01';
//     gvoLocateLabel.anchorPoint = 'bottomLeft';
//     gvoLocateLabel.percentOpacity = 85;
//     gvoLocateLabel.anchorLatLng = new GLatLng (Number(psLat), Number(psLon));
//     gvoLocateLabel.markerOffset = new GSize (-3,0);
//     gvoLocateLabel.content = '<div class="posTip">'; 
//     gvoLocateLabel.content += psMsg;
//     gvoLocateLabel.content += '</div>';
//     gvoMap.addTLabel(gvoLocateLabel);
// }

function onPhotoSlideShow(psPhotos) {
    if (gvoMap == null)
        return;
        
    if (gvbMapInit == false) return;
    
    var photos = eval('('+psPhotos+')');
    if (photos && photos.length > 0)
    {
        myLytebox.userResetImage(); 
        for (var i=0; i<photos.length; i++) {
            myLytebox.userAppendImage(photos[i], true);
        }
        myLytebox.userStart(true);    
    }
}

function onPhotoShow(psPhoto, psPhotoTitle) {
    if (gvoMap == null)
        return;
        
    if (gvbMapInit == false) return;
    
    if (psPhoto) {
        myLytebox.userResetImage();
        myLytebox.userAppendPhoto(psPhoto, psPhotoTitle, false);
        myLytebox.userStart(false);
    }
}

function onPhotoClose() {
    if (gvoMap == null)
        return;
        
    if (gvbMapInit == false) return;
    myLytebox.end();
}

function showPoiInfo(PoiId, bDestMarker) {
    if (gvoMap == null)
        return;
        
    var poPoi = findPOI(PoiId);
    if (poPoi != null && poPoi.name != null) {
        var info = infoMarker(poPoi, bDestMarker);
        var infowindowOptions = {content: info, pixelOffset: new google.maps.Size(0, poPoi.marker.getIcon().size.height/2)};
        var infowindow = new google.maps.InfoWindow(infowindowOptions);
        poPoi.marker.infowindow = infowindow;
        google.maps.event.addListener(infowindow, "closeclick", function() {
            gvoInfowindow = null;
        });
        
        if (gvoInfowindow != null)
            gvoInfowindow.close();
        infowindow.open(gvoMap, poPoi.marker);
        gvoInfowindow = infowindow;
        
        myLytebox.updateLyteboxItems(); 
        gvbBullonOnfocus = true;
    } 
}

function showPoiLocation(PoiId, bDestMarker) {
    if (gvoMap == null)
        return;
        
    var poPoi = findPOI(PoiId);
    
    var location = '<div class="pmInfo">';

    if (poPoi != null && poPoi.name != null) {
        location += '<b>'+jstringToHtml(poPoi.name)+'</b>';
        location +=' - <a href="javascript:OnClick=showPoiInfo('+poPoi.id+','+bDestMarker+')">'+strInfoWin_BackToInfoCmd+'</a>';

        location += '<br /><br /><center><div id="minimap" style="width: 200px; height: 180px"></div></center></div>';
        
        var infowindowOptions = {content: location, pixelOffset: new google.maps.Size(0, poPoi.marker.getIcon().size.height/2)};
        var infowindow = new google.maps.InfoWindow(infowindowOptions);
        
        google.maps.event.addListener(infowindow, "closeclick", function() {
            gvoInfowindow = null;
        });
        google.maps.event.addListener(infowindow, 'domready', function() {
            bindMiniMap(poPoi.marker);
        });
        
        if (gvoInfowindow != null)
            gvoInfowindow.close();
        infowindow.open(gvoMap, poPoi.marker);
        gvoInfowindow = infowindow;
        
        gvbBullonOnfocus = true;
    } 
}

function infoMarker(poPoi, bDestMarker) {
    var info = '<div class="pmInfo" style="overflow:auto;">'; // MARY
    //var location = '<div class="pmInfo">';

    if (poPoi != null) {
        if (poPoi.name != null) { 
            info += '<b>'+jstringToHtml(poPoi.name)+'</b>';
            //location += '<b>'+jstringToHtml(poPoi.name)+'</b>';
      
            info+=' - <a href="javascript:OnClick=showPoiLocation('+poPoi.id+','+bDestMarker+')">'+strInfoWIn_ShowLocationCmd+'</a>';
            
            if (gvoInitOption.poiCmd.funcEdit == true) {
                if (bDestMarker != null && bDestMarker == true && gCanAddDestination == true) {
                    info+=' - <a href="javascript:OnClick=appEditDest('+poPoi.id+')">';
                    info+=strInfoWin_Edit_Cmd;
                    info+= '</a>';
                } else {
                    //info+=' - <a href="javascript:OnClick=appEditPOI('+poPoi.id+')">Edit</a>';
                    info+=' - <a href="javascript:OnClick=appEditPOI('+poPoi.id+')">';
                    info+=strInfoWin_Edit_Cmd;
                    info+= '</a>';
                }
            }
            
            if (gvoInitOption.poiCmd.funcSaveAsTarget == true) {
                //info+=' - <a href="javascript:OnClick=appPOISaveAsTarget('+poPoi.id+')">Save as target</a>';
                info+=' - <a href="javascript:OnClick=appPOISaveAsTarget('+poPoi.id+')">';
                info+=strInfoWin_SaveAsTarget_Cmd;
                info+='</a>';
            }
            
            info+='<br /><div class="poiFiles">';
            // time
            
            if (poPoi.memo != null) { 
                //info=info+jstringToHtml(poPoi.memo); 
                info=info+poPoi.memo; 
            }
          
            // photos
            for (var i=0; i<poPoi.photos.length; i++) {
                info=info+'<br /><a href="javascript:OnClick=onLyteBoxShow('+poPoi.id+','+i+')" title="'+poPoi.photos[i].title+'" ><img src="'+poPoi.photos[i].thumb+'" border="0" /></a><br />'+jstringToHtml(poPoi.photos[i].title)+'<br />';
            }
          
            info = info+'</div>'; 
        }
    } 
    info += '</div>';
     
   // location += '<br /><br /><center><div id="minimap" style="width: 200px; height: 180px"></div></center></div>';
    
    //var infoTab = new GInfoWindowTab("Info", info);
	//var miniMapTab = new GInfoWindowTab("Location", location);
	//var infoTabs = [infoTab, miniMapTab];
    //return infoTabs; 
    return info;
}

function infoLine(poLine) {
    var info = '<div class="lineInfo">';
  
    if (poLine != null) {
        if (poLine.name != null) { 
        info +='<b>'+jstringToHtml(poLine.name)+'</b> <a href="javascript:OnClick=onFitLine('+gvnLineType+', '+poLine.id+')"> - ';
        info +=strInfoWin_LineFit_Cmd;
        info +=' </a> <br />';
        //Mary
        //info +='Start point: ' + poLine.startLat + ',' + poLine.startLon + '<br />';
        //info=info+'Start time: ' + poLine.startLat + ',' + poLine.startLon + '<br />';
        info +='Jelen skok, Olomuany, Pod Pokojnou, Jedovnice <br />';
        info +='Total Distance:' + poLine.distance + 'km <br />';
        //info +='<div id="minimap" style="width: 180px; height: 150px;"></div>';
        }
    }
  
    info += '</div>'; 
    return info; 
}

function infoPosition(pdLat, pdLng) {
    var info = '<div class="pmLocate"> (lat:'+pdLat+', lng:'+pdLng+') </div>';
    return info; 
}


///////////////////////////////////////////////////////////////////////////////
/// Functions for finding objects
///////////////////////////////////////////////////////////////////////////////
function findPOI(pnPoiID) {
    if (gvoaMarkers && gvoaMarkers.length > 0) {
        for (var i=0; i<gvoaMarkers.length; i++) {
            if (gvoaMarkers[i].id == pnPoiID)
                return gvoaMarkers[i];
        }
    } 
    return null;
}

function findPOIIndex(pnPoiID) {
    if (gvoaMarkers && gvoaMarkers.length > 0) {
        for (var i=0; i<gvoaMarkers.length; i++) {
            if (gvoaMarkers[i].id == pnPoiID)
                return i;
        }
    } 
    return -1;
}

function removePOI(pnPoiID) {
    if (gvoaMarkers && gvoaMarkers.length > 0) {
		var nID = -1;
        for (var i=0; i<gvoaMarkers.length; i++) {
            if (gvoaMarkers[i].id == pnPoiID)
				nID = i;
        }
        
        if (nID > -1) {
			if (gvoaMarkers[nID].marker) {
			    gvoaMarkers[nID].marker.setMap(null);
				gvoaMarkers[nID].marker = null;
			}
			gvoaMarkers.splice(nID, 1);
			
			// clear location marker
			if (gvoLocateMarker != null) {
			    gvoLocateMarker.setMap(null);
			    gvoLocateMarker = null;
			}
        }
    } 
}

function findLine(pnLineID) {
    if (gvoaLines && gvoaLines.length > 0) {
        for (var i=0; i<gvoaLines.length; i++) {
            if (gvoaLines[i].id == pnLineID)
                return gvoaLines[i];
        }
    } 
  
    return null;
}

function findLineIndex(pnLineID) {
    if (gvoaLines && gvoaLines.length > 0) {
        for (var i=0; i<gvoaLines.length; i++) {
            if (gvoaLines[i].id == pnLineID)
                return i;
        }
    } 
    return -1;
}

function removeLine(pnLineID) {
    if (gvoaLines && gvoaLines.length > 0) {
		var nID = -1;
        for (var i=0; i<gvoaLines.length; i++) {
            if (gvoaLines[i].id == pnLineID)
				nID = i;
        }
        if (nID > -1) {
			if (gvoaLines[nID].marker) {
				gvoaLines[nID].startMarker.setMap(null);
				gvoaLines[nID].marker.setMap(null);
				gvoaLines[nID].marker = null;
			}
			gvoaLines.splice(nID, 1);
        }
    } 
}

function findMapTypeIndex(psTypeName) {
    if (gvbMapInit == false) return 0;

    var i=0;
  
    for (i=0; i<gvoaMapTypes.length; i++) {
        if (psTypeName == gvoaMapTypes[i].getName())
            return i;
    }
  
    return 0;
}

function findMapType(psTypeName) {
   if (gvbMapInit == false) return 0;

    var i=0;
  
    for (i=0; i<gvoaMapTypes.length; i++) {
        if (psTypeName == gvoaMapTypes[i].getName())
            return gvoaMapTypes[i];
    }
  
    return 0;
}

function findMapTypeByID(pnID) {
    if (gvbMapInit == false) return 0;
    if (pnID < gvoaMapTypes.length)
        return gvoaMapTypes[pnID];
    else
        return 0;
}

///////////////////////////////////////////////////////////////////////////////
/// Functions for pan, zoom of windows
///////////////////////////////////////////////////////////////////////////////
function wndPanCheck(pdLat, pdLng) { 
    if (gvbMapInit == false) return false;
    
    if (gvoCurMapBounds == null) return false; 
    var dislat = (gvoCurMapBounds.getNorthEast().lat() - gvoCurMapBounds.getSouthWest().lat())/10*4; 
    var dislng = (gvoCurMapBounds.getNorthEast().lng() - gvoCurMapBounds.getSouthWest().lng())/10*4; 
    var lolat = gvoCurMapBounds.getCenter().lat() - dislat; 
    var hilat = gvoCurMapBounds.getCenter().lat() + dislat; 
    var lolng = gvoCurMapBounds.getCenter().lng() - dislng; 
    var hilng = gvoCurMapBounds.getCenter().lng() + dislng; 
  
    if (pdLat < lolat || pdLat > hilat || pdLng < lolng || pdLng > hilng) 
        return true; 
    else
        return false;  
}

function wndZoomTo(psLat, psLng, psAppZoom) {
    if (gvoMap == null)
        return;
    
    if (gvbMapInit == false) return;
    
    var lat = Number(psLat);
    var lng = Number(psLng);
    var mZoom = Number(psAppZoom);
  
    if (mZoom < 0) {
        mZoom = 0; 
    } else if (mZoom > 18) { 
        mZoom = 18; 
    }
  
    if (gvoCenterPoint.lat() != lat || gvoCenterPoint.lng() != lng || gvnCurZoom != mZoom) {
        gvnCurZoom = mZoom;
        gvoCenterPoint = new google.maps.LatLng(lat, lng);
        gvoMap.setCenter(gvoCenterPoint);
        gvoMap.setZoom(gvnCurZoom);
        gvoCurMapBounds = gvoMap.getBounds();
    }
}

///////////////////////////////////////////////////////////////////////////////
/// functions for window size
///////////////////////////////////////////////////////////////////////////////
function wndGetHeight() {
    if (self.innerHeight)
        return self.innerHeight;
    
    if (document.documentElement && document.documentElement.clientHeight)
        return y = document.documentElement.clientHeight;
    
    if (document.body)
        return document.body.clientHeight;
    
    return 0;
}

function wndGetWidth() {
    if (self.innerWidth)
        return self.innerWidth;
    
    if (document.documentElement && document.documentElement.clientWidth)
        return y = document.documentElement.clientWidth;
    
    if (document.body)
        return document.body.clientWidth;
    
    return 0;
}

function wndResize() {
    var height = wndGetHeight() - 30;
    var width = wndGetWidth() - 20;
  
    document.getElementById('gMap').style.height = height + 'px';
    document.getElementById('gMap').style.width = width + 'px';
}

///////////////////////////////////////////////////////////////////////////////
/// functions for actions
///////////////////////////////////////////////////////////////////////////////
function actSlideShow() { 
    if (gvbMapInit == false) return;
    
    var photoNo = 0; 
    myLytebox.userResetImage(); 
    for (var i=0; i<gvoaMarkers.length; i++) { 
        if (gvoaMarkers[i].photos.length) { 
            photoNo = photoNo + gvoaMarkers[i].photos.length; 
            myLytebox.userAppendImage(gvoaMarkers[i].photos, true); 
        } 
    } 
  
    if (photoNo) 
        myLytebox.userStart(true);  
}

function appAddSearchResultAsPOI(name, lat, lng, bSaveAsTarget, description) {
    if (name == null || name =='')
        return;
       
    var strSaveAsTarget = (bSaveAsTarget == true)? 'true' : 'false'; 
    if (description != null && description != '') {
        commSendCmd("UserAddPOI:"+lat+":"+lng+":"+name+":"+strSaveAsTarget+":"+description);
    } else {
        commSendCmd("UserAddPOI:"+lat+":"+lng+":"+name+":"+strSaveAsTarget);
    }
}

function appReload() {
    if (gvoMap == null) {
        commSendCmd("ReloadGoogleMapPage");
        return;
    }
        
    if (gvbMapInit == false) return;
    
    var newCP = gvoMap.getCenter();
    var mZoom = gvoMap.getZoom();
    var mType = gvoMap.getMapTypeId();
  
    commSendCmd("RefreshStatus:"+findMapTypeIndex(mType)+":"+mZoom+":"+newCP.lat()+":"+newCP.lng()+":"+gvnCurPOIID+":"+gvbBullonOnfocus);
}

function appReloadData() {
    if (gvoMap == null || gvbMapInit == false) {
        return;
    }
    
    // reset all data
    //gvoMap.clearOverlays();
    if (gvoaMarkers) {
        for (var i = 0; i < gvoaMarkers.length; i++ ) {
            gvoaMarkers[i].marker.setMap(null);
        }
    }
    if (gvoaLines) {
        for (var i = 0; i < gvoaLines.length; i++ ) {
            gvoaLines[i].startMarker.setMap(null);
            gvoaLines[i].marker.setMap(null);
        }
    }
    if (gvoLocateMarker)
        gvoLocateMarker.setMap(null);
    if (gvoGraphMarker1)
        gvoGraphMarker1.setMap(null);
    if (gvoGraphMarker2)
        gvoGraphMarker2.setMap(null);
    if (gvoInfowindow)
        gvoInfowindow.close();

    gvoLocateIcon = null;
    gvoLocateMarker = null;
    gvnCurPOIID = 0;
    gvnCurLineID = 0;
    gvoaMarkers = [];
    gvoaLines = [];
    gvoaIcons = [];
    gvoGraphMarker1 = null;
    gvoGraphMarker2 = null;
    gvoInfowindow = null;
    
    commSendCmd("GenerateData");
}

////////////////////////////////////////////////////////////////////////////////
/// function for screen capture
////////////////////////////////////////////////////////////////////////////////
function appEnableScreenCapture(strEnableJSon) {
    if (gvoMap == null || gvbMapInit == false) {
        return;
    }
    
    var bEnable = eval('('+strEnableJSon+')');
    gvoEnableScreenCapture = bEnable;
    
    var voEditButtonDiv = document.getElementById('buttonwrapper');
    if (voEditButtonDiv == null) {
        appCreateScreenCaptureButton();
    }
    
    if (bEnable == false) {
        document.getElementById('buttonwrapper').style.visibility = 'hidden';
    } else {
        document.getElementById('buttonwrapper').style.visibility = 'visible';
    }
}

function appCreateScreenCaptureButton() {
    
    var strCmdString = strInfoWin_ScreenCapture;  //string in multilanguage
    var voDivEditButton = document.createElement('div');
    voDivEditButton.setAttribute('id', 'ScreenCapture_buttonwrapper');
    voDivEditButton.innerHTML = "<a class='squarebutton' href='javascript:OnClick=appScreenCapture()' title='"+ strCmdString +"'><span>" + strCmdString + "</span></a>";
    document.body.appendChild(voDivEditButton);  

}
////////////////////////////////////////////////////////////////////////////////

//function appFitAllObject() {
//    if (gvoaLines.length <= 0 && gvoaMarkers.length <= 0)
//        return;
//
//    var areaBound = null;
//    
//    for (var i = 0; i < gvoaMarkers.length; i++) {
//        var poi = gvoaMarkers[i];
//        if (areaBound == null) {
//            areaBound = new GLatLngBounds(poi.marker.getPoint(), poi.marker.getPoint());
//        } else {
//            areaBound.extend(poi.marker.getPoint());
//        }  
//    }
//     if (gvoaLines.length == 1) {
//         var line = gvoaLines[0];
//         onFitLine(gvnLineType, line.id);
//     } else {
//         for (var i = 0; i < gvoaLines.length; i++) {
//             var line = gvoaLines[i];
//             if (areaBound == null) {
//                 areaBound = line.marker.getBounds();
//             } else {
//                 areaBound.containsBounds(line.marker.getBounds());
//             }
//         }
//         
//         if (areaBound) {
//             gvoCenterPoint = areaBound.getCenter();
//             gvnCurZoom = gvoMap.getBoundsZoomLevel(areaBound);
//             gvoMap.setCenter(gvoCenterPoint, gvnCurZoom);
//             gvoCurMapBounds = gvoMap.getBounds();
//         }
//     }
// }

function appGenerateData(psLinesJson, psPOIsJson, psIconPosOptJson) {
    gvoaLines = eval('('+psLinesJson+')');
    gvoaMarkers = eval('('+psPOIsJson+')');
    var _iconPosOpt = eval('('+psIconPosOptJson+')');
    gvoInitOption.iconPosOpt = _iconPosOpt;
    gvoLocateIcon = createIcon(_iconPosOpt);

    drawLineMarkers();
    drawPointMarkers();
    commSendCmd('onAfterInitGData');
    //appFitAllObject();
}

function appSelectLine(pnLineID) {
    if (gvbMapInit == false) return;
    
    commSendCmd("LineSelect:"+pnLineID);
}

function appEditPOI(pnPoiID) {
    if (gvbMapInit == false) return;
    
    commSendCmd("POIProperyEdit:"+pnPoiID);
}

function appEditDest(pnPoiID) {
    if (gvbMapInit == false) return;
    
    commSendCmd("DestProperyEdit:"+pnPoiID);
}

function appPOISaveAsTarget(pnPoiID) {
    if (gvbMapInit == false) return;
    
    commSendCmd("POISaveAsTarget:"+pnPoiID);
}

function onLyteBoxShow(pnPoiID, photoAryIdx) {
    if (gvbMapInit == false) return;
    
    var poi = findPOI(pnPoiID);
    if (poi != null) {
        onPhotoShow(poi.photos[photoAryIdx].link, poi.photos[photoAryIdx].title);
    }
}

function appZoomTo() {
    if (gvoMap == null)
        return;
        
    if (gvbMapInit == false) return;
    
    var newCP = gvoMap.getCenter();
    var mZoom = gvoMap.getZoom();
  
    if (gvoCenterPoint.lat() != newCP.lat() || gvoCenterPoint.lng() != newCP.lng() || gvnCurZoom != mZoom) {
        gvoCenterPoint = newCP;
        gvnCurZoom = mZoom;
        gvoCurMapBounds = gvoMap.getBounds();
            
        // tell application
        commSendCmd("wndZoomTo:"+newCP.lat()+":"+newCP.lng()+":"+gvnCurZoom);
    }
}

///////////////////////////////////////////////////////////////////////////////
/// Functions for add poi
///////////////////////////////////////////////////////////////////////////////
function userPOI() {
    if (gvbMapInit == false) return;

    if (gvoAddPOI.mode == true)
        normalMode();
    else
        addPOIMode();
}

function addPOIMode() {
    if (gvoMap == null)
        return;
        
    if (gvbMapInit == false) return;
    
    gvoAddPOI.mode = true;
    var markerOptions = { position: new google.maps.LatLng(0, 0), icon: gvoUserPOIIcon, draggable: true };
    gvoAddPOI.marker = new google.maps.Marker(markerOptions);
    gvoAddPOI.moveHDL = google.maps.event.addListener(gvoMap, 'mousemove', userPOIMove);
    gvoAddPOI.clickHDL = google.maps.event.addListener(gvoAddPOI.marker, 'click', userPOIClick);
    gvoAddPOI.marker.setMap(gvoMap);
    gvoMap.setOptions({draggable: false});
    //document.getElementById("gMap").style.cursor = "default"; 
}

function userDest() {
    if (gvbMapInit == false) return;

    if (gvoAddPOI.mode == true)
        normalMode();
    else
        addDestMode();
}

function addDestMode() {
    if (gvoMap == null)
        return;
        
    if (gvbMapInit == false) return;
    
    gvoAddPOI.mode = true;
    var markerOptions = { position: new google.maps.LatLng(0, 0), icon: gvoUserDestIcon, draggable: true };
    gvoAddPOI.marker = new google.maps.Marker(markerOptions);
    gvoAddPOI.moveHDL = google.maps.event.addListener(gvoMap, 'mousemove', userPOIMove);
    gvoAddPOI.clickHDL = google.maps.event.addListener(gvoAddPOI.marker, 'click', userDestClick);
    gvoAddPOI.marker.setMap(gvoMap);
    gvoMap.setOptions({draggable: false});
    //document.getElementById("gMap").style.cursor = "default";    
}

function normalMode() {
    if (gvoMap == null)
        return;
        
    if (gvbMapInit == false) return;
    
    google.maps.event.removeListener(gvoAddPOI.moveHDL);
    google.maps.event.removeListener(gvoAddPOI.clickHDL);
    gvoAddPOI.marker.setMap(null);
    gvoMap.setOptions({draggable: true});
    gvoAddPOI.mode = false;
    gvoAddPOI.marker = null;
    gvoAddPOI.moveHDL = null;
    gvoAddPOI.clickHDL = null;
}

function userPOIMove(mouseEvent) {
    if (gvbMapInit == false) return;
    
    if (gvoAddPOI.mode == true) {
        gvoAddPOI.marker.setPosition(mouseEvent.latLng);
    }
}

function userPOIClick(mouseEvent) {
    if (gvbMapInit == false) return;
    
    // to resolve the problem that can not add POI on track or Placemark
    pt = gvoAddPOI.marker.getPosition();
    
    if (gvoAddPOI.mode == true && pt != null) {
        var lat = pt.lat();
        var lng = pt.lng();
        commSendCmd("UserAddPOI:"+lat+":"+lng);
        normalMode();
    }
}

function userDestClick(mouseEvent) {
    if (gvbMapInit == false) return;
    
    // to resolve the problem that can not add POI on track or Placemark
    pt = gvoAddPOI.marker.getPosition();
    
    if (gvoAddPOI.mode == true && pt != null) {
        var lat = pt.lat();
        var lng = pt.lng();

        commSendCmd("UserAddDest:"+lat+":"+lng);
        normalMode();
    }
}

function initLogoDisplay(logoFileName) {
    if (logoFileName != null) {
        gDisplayLogo = true;
        gDisplayLogoFileName = logoFileName;
    }
}

function enableDestination() {
    gCanAddDestination = true;
}

function enableEarthView() {
    gvoEnableEarthView = true;
}

function appScreenCapture() {
    if (gvbMapInit == false) return;
    
    commSendCmd("ScreenCapture");
}

///////////////////////////////////////////////////////////////////////////////
/// functions for communication with application
///////////////////////////////////////////////////////////////////////////////
function commSendCmd(psMessage) {
    if (gApJsCtrl == true) {
        window.status = "cmd:"+psMessage;
        window.location = "cmd:"+psMessage;
    }
}
</script>
<!-- END HERE -->
<script type="text/javascript">
//<![CDATA[
var gvoaMarkers = [
{'id':1,'lat':49.313980,'lon':16.644430,'name':'Lat:49.313980, Lon:16.644430, Ele:240.996094', 'UTC':[2015,5,18,14,42,42],'memo':'','isdest':false,'icon':'push_to_log.png','lineid':0,'marker':null,'photos':[{'id':1,'thumb':'map.files/t1.jpg','link':'map.files/p1.jpg','title':''},{'id':2,'thumb':'map.files/t2.jpg','link':'map.files/p2.jpg','title':''},{'id':3,'thumb':'map.files/t3.jpg','link':'map.files/p3.jpg','title':''}],'vedios':[]},
{'id':2,'lat':49.322716,'lon':16.645123,'name':'Lat:49.322716, Lon:16.645123, Ele:373.117188', 'UTC':[2015,5,18,14,58,16],'memo':'','isdest':false,'icon':'push_to_log.png','lineid':0,'marker':null,'photos':[{'id':4,'thumb':'map.files/t4.jpg','link':'map.files/p4.jpg','title':''}, {'id':5,'thumb':'map.files/t5.jpg','link':'map.files/p5.jpg','title':''}],'vedios':[]},
{'id':3,'lat':49.321793,'lon':16.669382,'name':'Lat:49.321793, Lon:16.669382, Ele:410.132813', 'UTC':[2015,5,18,15,11,51],'memo':'','isdest':false,'icon':'push_to_log.png','lineid':0,'marker':null,'photos':[{'id':6,'thumb':'map.files/t6.jpg','link':'map.files/p6.jpg','title':''},{'id':7,'thumb':'map.files/t7.jpg','link':'map.files/p7.jpg','title':''},{'id':8,'thumb':'map.files/t8.jpg','link':'map.files/p8.jpg','title':''}],'vedios':[]},
{'id':4,'lat':49.320038,'lon':16.673651,'name':'Lat:49.320038, Lon:16.673651, Ele:434.640625', 'UTC':[2015,5,18,15,17,38],'memo':'','isdest':false,'icon':'push_to_log.png','lineid':0,'marker':null,'photos':[{'id':9,'thumb':'map.files/t9.jpg','link':'map.files/p9.jpg','title':''},{'id':10,'thumb':'map.files/t10.jpg','link':'map.files/p10.jpg','title':''}],'vedios':[]},
{'id':104,'lat':49.318840,'lon':16.676426,'name':'Lat:49.318840, Lon:16.676426, Ele:434.640625', 'UTC':[2015,5,18,15,19,13],'memo':'','isdest':false,'icon':'push_to_log.png','lineid':0,'marker':null,'photos':[{'id':11,'thumb':'map.files/t11.jpg','link':'map.files/p11.jpg','title':''},{'id':12,'thumb':'map.files/t12.jpg','link':'map.files/p12.jpg','title':''},{'id':13,'thumb':'map.files/t13.jpg','link':'map.files/p13.jpg','title':''}],'vedios':[]},
{'id':5,'lat':49.320911,'lon':16.678946,'name':'Lat:49.320911, Lon:16.678946, Ele:433.593750', 'UTC':[2015,5,18,15,22,2],'memo':'','isdest':false,'icon':'push_to_log.png','lineid':0,'marker':null,'photos':[{'id':14,'thumb':'map.files/t14.jpg','link':'map.files/p14.jpg','title':''}],'vedios':[]},
{'id':6,'lat':49.320354,'lon':16.678432,'name':'Lat:49.320354, Lon:16.678432, Ele:432.398438', 'UTC':[2015,5,18,15,23,1],'memo':'','isdest':false,'icon':'push_to_log.png','lineid':0,'marker':null,'photos':[{'id':15,'thumb':'map.files/t15.jpg','link':'map.files/p15.jpg','title':''}],'vedios':[]},
{'id':7,'lat':49.322647,'lon':16.679731,'name':'Lat:49.322647, Lon:16.679731, Ele:428.476563', 'UTC':[2015,5,18,15,25,42],'memo':'','isdest':false,'icon':'push_to_log.png','lineid':0,'marker':null,'photos':[{'id':16,'thumb':'map.files/t16.jpg','link':'map.files/p16.jpg','title':''}],'vedios':[]},
{'id':8,'lat':49.323612,'lon':16.679634,'name':'Lat:49.323612, Lon:16.679634, Ele:422.882813', 'UTC':[2015,5,18,15,27,8],'memo':'','isdest':false,'icon':'push_to_log.png','lineid':0,'marker':null,'photos':[{'id':17,'thumb':'map.files/t17.jpg','link':'map.files/p17.jpg','title':''}],'vedios':[]},
{'id':9,'lat':49.324631,'lon':16.680292,'name':'Lat:49.324631, Lon:16.680292, Ele:427.343750', 'UTC':[2015,5,18,15,28,29],'memo':'','isdest':false,'icon':'push_to_log.png','lineid':0,'marker':null,'photos':[{'id':18,'thumb':'map.files/t18.jpg','link':'map.files/p18.jpg','title':''}],'vedios':[]},
{'id':10,'lat':49.328838,'lon':16.687897,'name':'Lat:49.328838, Lon:16.687897, Ele:448.773438', 'UTC':[2015,5,18,15,32,51],'memo':'','isdest':false,'icon':'push_to_log.png','lineid':0,'marker':null,'photos':[{'id':19,'thumb':'map.files/t19.jpg','link':'map.files/p19.jpg','title':''},{'id':20,'thumb':'map.files/t20.jpg','link':'map.files/p20.jpg','title':''}],'vedios':[]},
{'id':11,'lat':49.334404,'lon':16.698858,'name':'Lat:49.334404, Lon:16.698858, Ele:488.445313', 'UTC':[2015,5,18,15,43,22],'memo':'','isdest':false,'icon':'push_to_log.png','lineid':0,'marker':null,'photos':[{'id':21,'thumb':'map.files/t21.jpg','link':'map.files/p21.jpg','title':''},{'id':22,'thumb':'map.files/t22.jpg','link':'map.files/p22.jpg','title':''}],'vedios':[]},
{'id':12,'lat':49.324074,'lon':16.720264,'name':'Lat:49.324074, Lon:16.720264, Ele:528.703125', 'UTC':[2015,5,18,15,52,49],'memo':'','isdest':false,'icon':'push_to_log.png','lineid':0,'marker':null,'photos':[{'id':23,'thumb':'map.files/t23.jpg','link':'map.files/p23.jpg','title':''}],'vedios':[]},
{'id':13,'lat':49.324341,'lon':16.720507,'name':'Lat:49.324341, Lon:16.720507, Ele:535.828125', 'UTC':[2015,5,18,15,53,58],'memo':'','isdest':false,'icon':'push_to_log.png','lineid':0,'marker':null,'photos':[{'id':24,'thumb':'map.files/t24.jpg','link':'map.files/p24.jpg','title':''}],'vedios':[]},
{'id':14,'lat':49.329376,'lon':16.717779,'name':'Lat:49.329376, Lon:16.717779, Ele:522.250000', 'UTC':[2015,5,18,15,56,46],'memo':'','isdest':false,'icon':'push_to_log.png','lineid':0,'marker':null,'photos':[{'id':25,'thumb':'map.files/t25.jpg','link':'map.files/p25.jpg','title':''}, {'id':26,'thumb':'map.files/t26.jpg','link':'map.files/p26.jpg','title':''}],'vedios':[]},
{'id':114,'lat':49.330532,'lon':16.719412,'name':'Lat:49.330532, Lon:16.719412, Ele:520.250000', 'UTC':[2015,5,18,15,58,38],'memo':'','isdest':false,'icon':'push_to_log.png','lineid':0,'marker':null,'photos':[{'id':27,'thumb':'map.files/t27.jpg','link':'map.files/p27.jpg','title':''}, {'id':28,'thumb':'map.files/t28.jpg','link':'map.files/p28.jpg','title':''}],'vedios':[]},
{'id':15,'lat':49.332603,'lon':16.723341,'name':'Lat:49.332603, Lon:16.723341, Ele:516.234375', 'UTC':[2015,5,18,16,6,2],'memo':'','isdest':false,'icon':'push_to_log.png','lineid':0,'marker':null,'photos':[{'id':30,'thumb':'map.files/t30.jpg','link':'map.files/p30.jpg','title':''},{'id':29,'thumb':'map.files/t29.jpg','link':'map.files/p29.jpg','title':''}],'vedios':[]},
{'id':16,'lat':49.332989,'lon':16.724323,'name':'Lat:49.332989, Lon:16.724323, Ele:512.796875', 'UTC':[2015,5,18,16,6,56],'memo':'','isdest':false,'icon':'push_to_log.png','lineid':0,'marker':null,'photos':[{'id':31,'thumb':'map.files/t31.jpg','link':'map.files/p31.jpg','title':''}],'vedios':[]},
{'id':17,'lat':49.332993,'lon':16.724747,'name':'Lat:49.332993, Lon:16.724747, Ele:512.750000', 'UTC':[2015,5,18,16,7,27],'memo':'','isdest':false,'icon':'push_to_log.png','lineid':0,'marker':null,'photos':[{'id':32,'thumb':'map.files/t32.jpg','link':'map.files/p32.jpg','title':''}],'vedios':[]},
{'id':18,'lat':49.333241,'lon':16.725817,'name':'Lat:49.333241, Lon:16.725817, Ele:511.171875', 'UTC':[2015,5,18,16,8,12],'memo':'','isdest':false,'icon':'push_to_log.png','lineid':0,'marker':null,'photos':[{'id':33,'thumb':'map.files/t33.jpg','link':'map.files/p33.jpg','title':''}],'vedios':[]},
{'id':19,'lat':49.333549,'lon':16.725756,'name':'Lat:49.333549, Lon:16.725756, Ele:510.210938', 'UTC':[2015,5,18,16,8,46],'memo':'','isdest':false,'icon':'push_to_log.png','lineid':0,'marker':null,'photos':[{'id':34,'thumb':'map.files/t34.jpg','link':'map.files/p34.jpg','title':''}],'vedios':[]},
{'id':20,'lat':49.335617,'lon':16.725683,'name':'Lat:49.335617, Lon:16.725683, Ele:496.476563', 'UTC':[2015,5,18,16,9,47],'memo':'','isdest':false,'icon':'push_to_log.png','lineid':0,'marker':null,'photos':[{'id':35,'thumb':'map.files/t35.jpg','link':'map.files/p35.jpg','title':''}, {'id':36,'thumb':'map.files/t36.jpg','link':'map.files/p36.jpg','title':''}],'vedios':[]},
{'id':21,'lat':49.335938,'lon':16.726288,'name':'Lat:49.335938, Lon:16.726288, Ele:491.078125', 'UTC':[2015,5,18,16,10,30],'memo':'','isdest':false,'icon':'push_to_log.png','lineid':0,'marker':null,'photos':[{'id':37,'thumb':'map.files/t37.jpg','link':'map.files/p37.jpg','title':''}, {'id':38,'thumb':'map.files/t38.jpg','link':'map.files/p38.jpg','title':''}],'vedios':[]},
{'id':22,'lat':49.335953,'lon':16.726982,'name':'Lat:49.335953, Lon:16.726982, Ele:488.875000', 'UTC':[2015,5,18,16,11,18],'memo':'','isdest':false,'icon':'push_to_log.png','lineid':0,'marker':null,'photos':[{'id':39,'thumb':'map.files/t39.jpg','link':'map.files/p39.jpg','title':''}],'vedios':[]},
{'id':23,'lat':49.335918,'lon':16.729893,'name':'Lat:49.335918, Lon:16.729893, Ele:484.937500', 'UTC':[2015,5,18,16,12,52],'memo':'','isdest':false,'icon':'push_to_log.png','lineid':0,'marker':null,'photos':[{'id':40,'thumb':'map.files/t40.jpg','link':'map.files/p40.jpg','title':''}, {'id':41,'thumb':'map.files/t41.jpg','link':'map.files/p41.jpg','title':''}],'vedios':[]},
{'id':24,'lat':49.336033,'lon':16.730652,'name':'Lat:49.336033, Lon:16.730652, Ele:483.671875', 'UTC':[2015,5,18,16,14,22],'memo':'','isdest':false,'icon':'push_to_log.png','lineid':0,'marker':null,'photos':[{'id':42,'thumb':'map.files/t42.jpg','link':'map.files/p42.jpg','title':''}],'vedios':[]},
{'id':25,'lat':49.335995,'lon':16.732052,'name':'Lat:49.335995, Lon:16.732052, Ele:474.039063', 'UTC':[2015,5,18,16,15,28],'memo':'','isdest':false,'icon':'push_to_log.png','lineid':0,'marker':null,'photos':[{'id':43,'thumb':'map.files/t43.jpg','link':'map.files/p43.jpg','title':''}],'vedios':[]},
{'id':26,'lat':49.335365,'lon':16.732985,'name':'Lat:49.335365, Lon:16.732985, Ele:469.398438', 'UTC':[2015,5,18,16,16,28],'memo':'','isdest':false,'icon':'push_to_log.png','lineid':0,'marker':null,'photos':[{'id':44,'thumb':'map.files/t44.jpg','link':'map.files/p44.jpg','title':''}, {'id':45,'thumb':'map.files/t45.jpg','link':'map.files/p45.jpg','title':''}],'vedios':[]},
{'id':27,'lat':49.335999,'lon':16.733732,'name':'Lat:49.335999, Lon:16.733732, Ele:484.156250', 'UTC':[2015,5,18,16,20,50],'memo':'','isdest':false,'icon':'push_to_log.png','lineid':0,'marker':null,'photos':[{'id':46,'thumb':'map.files/t46.jpg','link':'map.files/p46.jpg','title':''}],'vedios':[]},
{'id':28,'lat':49.336994,'lon':16.741503,'name':'Lat:49.336994, Lon:16.741503, Ele:488.171875', 'UTC':[2015,5,18,16,24,33],'memo':'','isdest':false,'icon':'push_to_log.png','lineid':0,'marker':null,'photos':[{'id':47,'thumb':'map.files/t47.jpg','link':'map.files/p47.jpg','title':''}],'vedios':[]},
{'id':29,'lat':49.337551,'lon':16.744610,'name':'Lat:49.337551, Lon:16.744610, Ele:480.148438', 'UTC':[2015,5,18,16,26,14],'memo':'','isdest':false,'icon':'push_to_log.png','lineid':0,'marker':null,'photos':[{'id':48,'thumb':'map.files/t48.jpg','link':'map.files/p48.jpg','title':''}, {'id':49,'thumb':'map.files/t49.jpg','link':'map.files/p49.jpg','title':''}],'vedios':[]},
{'id':30,'lat':49.338310,'lon':16.745852,'name':'Lat:49.338310, Lon:16.745852, Ele:479.781250', 'UTC':[2015,5,18,16,27,48],'memo':'','isdest':false,'icon':'push_to_log.png','lineid':0,'marker':null,'photos':[{'id':50,'thumb':'map.files/t50.jpg','link':'map.files/p50.jpg','title':''}, {'id':51,'thumb':'map.files/t51.jpg','link':'map.files/p51.jpg','title':''}],'vedios':[]},
{'id':31,'lat':49.339642,'lon':16.747337,'name':'Lat:49.339642, Lon:16.747337, Ele:464.132813', 'UTC':[2015,5,18,16,29,23],'memo':'','isdest':false,'icon':'push_to_log.png','lineid':0,'marker':null,'photos':[{'id':52,'thumb':'map.files/t52.jpg','link':'map.files/p52.jpg','title':''}],'vedios':[]},
{'id':32,'lat':49.339794,'lon':16.747499,'name':'Lat:49.339794, Lon:16.747499, Ele:465.976563', 'UTC':[2015,5,18,16,30,15],'memo':'','isdest':false,'icon':'push_to_log.png','lineid':0,'marker':null,'photos':[{'id':53,'thumb':'map.files/t53.jpg','link':'map.files/p53.jpg','title':''}],'vedios':[]},
{'id':33,'lat':49.339962,'lon':16.748007,'name':'Lat:49.339962, Lon:16.748007, Ele:466.125000', 'UTC':[2015,5,18,16,33,10],'memo':'','isdest':false,'icon':'push_to_log.png','lineid':0,'marker':null,'photos':[{'id':55,'thumb':'map.files/t55.jpg','link':'map.files/p55.jpg','title':''},{'id':54,'thumb':'map.files/t54.jpg','link':'map.files/p54.jpg','title':''}],'vedios':[]},
{'id':34,'lat':49.340160,'lon':16.748573,'name':'Lat:49.340160, Lon:16.748573, Ele:470.742188', 'UTC':[2015,5,18,16,36,11],'memo':'','isdest':false,'icon':'push_to_log.png','lineid':0,'marker':null,'photos':[{'id':56,'thumb':'map.files/t56.jpg','link':'map.files/p56.jpg','title':''}],'vedios':[]},
{'id':35,'lat':49.340927,'lon':16.749344,'name':'Lat:49.340927, Lon:16.749344, Ele:466.921875', 'UTC':[2015,5,18,16,38,22],'memo':'','isdest':false,'icon':'push_to_log.png','lineid':0,'marker':null,'photos':[{'id':57,'thumb':'map.files/t57.jpg','link':'map.files/p57.jpg','title':''}],'vedios':[]},
{'id':36,'lat':49.341232,'lon':16.750500,'name':'Lat:49.341232, Lon:16.750500, Ele:466.039063', 'UTC':[2015,5,18,16,39,35],'memo':'','isdest':false,'icon':'push_to_log.png','lineid':0,'marker':null,'photos':[{'id':58,'thumb':'map.files/t58.jpg','link':'map.files/p58.jpg','title':''}],'vedios':[]},
{'id':37,'lat':49.341560,'lon':16.751707,'name':'Lat:49.341560, Lon:16.751707, Ele:465.296875', 'UTC':[2015,5,18,16,40,43],'memo':'','isdest':false,'icon':'push_to_log.png','lineid':0,'marker':null,'photos':[{'id':59,'thumb':'map.files/t59.jpg','link':'map.files/p59.jpg','title':''}],'vedios':[]}];
var gvoaLines = [
{'id':1,'name':"2015/05/18 trasa 5119",'num':"",'pathAry':[[49.313976,16.644466],[49.314339,16.644497],[49.314583,16.644806],[49.315063,16.645763],[49.315220,16.646219],[49.315403,16.646385],[49.316093,16.646118],[49.316269,16.646130],[49.316910,16.645975],[49.317406,16.646103],[49.317696,16.646305],[49.317768,16.646423],[49.317928,16.646816],[49.318027,16.647411],[49.318230,16.647926],[49.318321,16.648502],[49.318333,16.649094],[49.318008,16.649887],[49.317947,16.650297],[49.318130,16.650793],[49.318356,16.651098],[49.318455,16.651072],[49.318459,16.650900],[49.318367,16.650156],[49.318520,16.649925],[49.318653,16.649370],[49.318909,16.648899],[49.319035,16.648342],[49.319294,16.648111],[49.319569,16.648054],[49.319843,16.647903],[49.320030,16.647892],[49.320293,16.647690],[49.320568,16.647282],[49.321152,16.646782],[49.321255,16.646364],[49.321655,16.645714],[49.322018,16.645586],[49.322052,16.645452],[49.322548,16.645330],[49.322788,16.645046],[49.322941,16.645124],[49.322842,16.645130],[49.323128,16.645346],[49.323318,16.645372],[49.323433,16.645458],[49.323513,16.645884],[49.323696,16.646049],[49.324093,16.646034],[49.324596,16.645870],[49.325333,16.645739],[49.325844,16.645771],[49.325916,16.645874],[49.325932,16.646358],[49.325489,16.647045],[49.325253,16.648024],[49.325665,16.648125],[49.326012,16.648312],[49.326103,16.648439],[49.326126,16.648733],[49.325966,16.649441],[49.325722,16.650000],[49.325409,16.651268],[49.325172,16.651789],[49.325111,16.652105],[49.325027,16.652397],[49.325237,16.652727],[49.325649,16.653030],[49.325806,16.653803],[49.325546,16.654264],[49.325516,16.654728],[49.325275,16.655378],[49.324963,16.655869],[49.324799,16.656281],[49.324799,16.656723],[49.323948,16.659029],[49.324036,16.659605],[49.324001,16.659887],[49.323734,16.660822],[49.323666,16.661434],[49.323544,16.661695],[49.323513,16.661993],[49.323174,16.662792],[49.322685,16.665241],[49.322220,16.666782],[49.322243,16.667240],[49.322094,16.667660],[49.321972,16.669081],[49.321754,16.669489],[49.321812,16.669554],[49.321720,16.669598],[49.321617,16.669830],[49.321590,16.669691],[49.321514,16.669764],[49.320988,16.671106],[49.320663,16.671467],[49.320366,16.672024],[49.320080,16.673084],[49.320084,16.673618],[49.320000,16.673731],[49.319927,16.673708],[49.320030,16.673927],[49.319759,16.675245],[49.319538,16.675669],[49.318909,16.676140],[49.318821,16.676678],[49.319061,16.677292],[49.319248,16.678335],[49.319382,16.678612],[49.319622,16.678675],[49.320210,16.678535],[49.320915,16.679014],[49.320827,16.678829],[49.320293,16.678404],[49.320370,16.678541],[49.320816,16.678877],[49.322922,16.679834],[49.323235,16.679863],[49.323540,16.679705],[49.323704,16.679686],[49.324112,16.679779],[49.324608,16.680325],[49.327053,16.683577],[49.327858,16.684774],[49.328175,16.685377],[49.328735,16.687630],[49.328972,16.688089],[49.328987,16.688417],[49.329151,16.688965],[49.329388,16.690413],[49.329559,16.690630],[49.329742,16.691044],[49.330067,16.691444],[49.330410,16.692047],[49.331039,16.692713],[49.331165,16.692968],[49.331581,16.693501],[49.331844,16.693790],[49.332043,16.693892],[49.332268,16.694237],[49.332367,16.694267],[49.332600,16.694586],[49.332874,16.694818],[49.333111,16.694874],[49.333885,16.695267],[49.334175,16.695530],[49.334351,16.695927],[49.334469,16.698435],[49.334408,16.698771],[49.334404,16.698502],[49.334015,16.699154],[49.333595,16.700254],[49.333355,16.700541],[49.333263,16.700846],[49.333172,16.700907],[49.332920,16.701590],[49.332157,16.702629],[49.331249,16.705276],[49.330910,16.705959],[49.330036,16.707226],[49.329487,16.708212],[49.328606,16.709293],[49.327919,16.710588],[49.327724,16.710974],[49.327312,16.711464],[49.326733,16.712330],[49.326504,16.713022],[49.324997,16.715790],[49.324848,16.716259],[49.324707,16.718346],[49.324089,16.720139],[49.324139,16.720419],[49.324306,16.720535],[49.324272,16.720407],[49.324471,16.720581],[49.324684,16.720621],[49.324879,16.720497],[49.325527,16.719677],[49.325993,16.719471],[49.326828,16.718836],[49.327602,16.718649],[49.328766,16.717886],[49.329021,16.717794],[49.329258,16.717833],[49.329338,16.717758],[49.329453,16.717838],[49.329422,16.717709],[49.329510,16.717733],[49.329800,16.718016],[49.330170,16.718548],[49.330494,16.719511],[49.330532,16.719412],[49.330612,16.719715],[49.330948,16.720362],[49.332554,16.723167],[49.332699,16.723785],[49.332993,16.724472],[49.333088,16.725447],[49.333317,16.725906],[49.333958,16.725626],[49.334820,16.725466],[49.335068,16.725477],[49.335621,16.725685],[49.335709,16.725658],[49.336006,16.726551],[49.335865,16.727493],[49.335831,16.728975],[49.336128,16.731909],[49.336060,16.732029],[49.335629,16.732372],[49.335377,16.732914],[49.335434,16.733236],[49.335995,16.733662],[49.336121,16.735806],[49.336182,16.736311],[49.336315,16.736755],[49.336422,16.738070],[49.336582,16.738853],[49.336575,16.739590],[49.336830,16.740608],[49.337006,16.741652],[49.337006,16.743557],[49.337490,16.744434],[49.337543,16.744566],[49.337498,16.744652],[49.337910,16.745146],[49.338356,16.745964],[49.338619,16.746283],[49.339134,16.746710],[49.339447,16.747177],[49.339798,16.747494],[49.339890,16.747938],[49.339996,16.748070],[49.340038,16.748503],[49.340481,16.748714],[49.340683,16.748924],[49.340939,16.749454],[49.340952,16.749359],[49.341000,16.749361],[49.341255,16.750288],[49.341209,16.750616],[49.341527,16.751754]],
'color':"#ff007f",'width':5,'distance':14,'minLat':49.28,'minLon':16.639189,'maxLat':49.35,'maxLon':16.78,'startLat':49.335393,'startLon':16.682542,'playPoints': [],'marker':null,'startMarker':null}];
gvoInitOption =  { "callByReload" : false , "iconLineOpt" :  { "anchorX" : 12 , "anchorY" : 28 , "fileName" : "line_flag.png" , "height" : 32 , "relPath" : "web/js/imgctrl/images/" , "width" : 32 }  , "iconMinimapPoiOpt" :  { "anchorX" : 8 , "anchorY" : 8 , "fileName" : "line_start.png" , "height" : 16 , "relPath" : "web/js/imgctrl/images/" , "width" : 16 }  , "iconPosOpt" :  { "anchorX" : 24 , "anchorY" : 25 , "fileName" : "locate.png" , "height" : 32 , "relPath" : "web/js/imgctrl/images/" , "width" : 32 }  , "mapBigControl" : true , "mapOverview" : true , "mapType" : 0 , "maxLat" : 49.344 , "maxLon" : 16.8057 , "minLat" : 49.214 , "minLon" : 16.6392 , "poiCmd" :  { "funcEdit" : false , "funcSaveAsTarget" : false }  , "sBar" : false , "startLat" : 49.3142 , "startLon" : 16.683 , "tBar" :  { "funcAddPOI" : false , "funcReload" : false , "funcSlideShow" : true }  , "zoomLevel" : 12 } ;
gvsProductPath = 'map.files/';
gvnPoiType = 9;
gvnLineType = 11;
gApJsCtrl = false;
window.onload = mapMain;
//]]>
</script>
</head>
<body>
<script type="text/javascript">
//<![CDATA[
initLayout();
//]]>
</script>
<p>If you see this message when blocked by viewing active content(Google Map), please click "Allow Blocked Content" to show the active content(Google Map).</p><p>Or change your Internet Explorer options:</p><ol><li>In Internet Explorer, go to <strong>Tools &gt; Internet Options</strong>.</li><li>Select the <strong>Advanced </strong>tab.</li><li>Go to the <strong>Security </strong>section.</li><li>Select the <strong>Allow active content from CDs to run on My Computer</strong> check box.</li><li>Select the <strong>Allow active content to run in files on My Computer</strong> check box.</li><li>Click <strong>OK</strong> to save your changes.</li></ol></body>
